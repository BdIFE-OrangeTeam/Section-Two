'use strict';

/**
` * el: canvas
  */
function Chess(el) {
  this.canvas = document.querySelector(el);
  this.pieceColor = true; // 棋子颜色: true 为黑色, false 为白色
  this.chessBoard = [];
  // AI
  this.wins = []; // 赢法数组
  this.count = 0; // 赢法种类
  // AI 赢法的统计数组
  this.myWin = [];
  this.computerWin = [];
  // 下棋是否下完
  this.over = false;

  this.context = this.canvas.getContext('2d');
  this.canvas.onclick = this.onclick.bind(this);
}

Chess.prototype = {
  init: function init(width, height) {
    for (var i = 0; i < 15; ++i) {
      this.chessBoard[i] = [];
      for (var j = 0; j < 15; j++) {
        this.chessBoard[i][j] = 0;
      }
    }

    // 赢法数组初始化
    for (var i = 0; i < 15; ++i) {
      this.wins[i] = [];
      for (var j = 0; j < 15; ++j) {
        this.wins[i][j] = [];
      }
    }

    // 横线
    for (var i = 0; i < 15; ++i) {
      for (var j = 0; j < 11; ++j) {
        // wins[0][0][0] = true
        // wins[0][1][0] = true
        // wins[0][2][0] = true
        // wins[0][3][0] = true
        // wins[0][4][0] = true

        // wins[0][1][1] = true
        // wins[0][2][1] = true
        // wins[0][3][1] = true
        // wins[0][4][1] = true
        // wins[0][5][1] = true
        for (var k = 0; k < 5; ++k) {
          this.wins[i][j + k][this.count] = true;
        }
        this.count++;
      }
    }

    // 竖线
    for (var i = 0; i < 15; ++i) {
      for (var j = 0; j < 11; ++j) {
        for (var k = 0; k < 5; ++k) {
          this.wins[j + k][i][this.count] = true;
        }
        this.count++;
      }
    }

    // 斜线
    for (var i = 0; i < 11; ++i) {
      for (var j = 0; j < 11; ++j) {
        for (var k = 0; k < 5; ++k) {
          this.wins[i + k][j + k][this.count] = true;
        }
        this.count++;
      }
    }

    // 反斜线
    for (var i = 0; i < 11; ++i) {
      for (var j = 14; j > 3; j--) {
        for (var k = 0; k < 5; ++k) {
          this.wins[i + k][j - k][this.count] = true;
        }
        this.count++;
      }
    }

    // 统计数组初始化
    for (var i = 0; i < this.count; ++i) {
      this.myWin[i] = 0;
      this.computerWin[i] = 0;
    }

    this.draw();
  },

  drawLine: function drawLine() {
    for (var i = 0; i < 15; ++i) {
      // 横线
      this.context.moveTo(15, 15 + 30 * i);
      this.context.lineTo(435, 15 + 30 * i);
      this.context.stroke();

      // 纵线
      this.context.moveTo(15 + 30 * i, 15);
      this.context.lineTo(15 + 30 * i, 435);
      this.context.stroke();
    }
  },
  drawPiece: function drawPiece(i, j, me) {
    this.context.beginPath();
    this.context.arc(15 + 30 * i, 15 + 30 * j, 13, 0, 2 * Math.PI);
    this.context.closePath();
    var gradient = this.context.createRadialGradient(15 + 30 * i + 2, 15 + 30 * j - 2, 13, 15 + 30 * i, 15 + 30 * j, 0);
    if (me) {
      gradient.addColorStop(0, '#0A0A0A');
      gradient.addColorStop(1, '#636766');
    } else {
      gradient.addColorStop(0, '#D1D1D1');
      gradient.addColorStop(1, '#F9F9F9');
    }

    this.context.fillStyle = gradient;
    this.context.fill();
  },
  loadBackground: function loadBackground(url) {
    var bg = new Image();
    bg.src = url || "images/bg.jpg";
    bg.style.opacity = "1";
    // bg.style.backgroundColor = "red";
    bg.onload = function () {
      this.context.drawImage(bg, 0, 0, 450, 450);

      this.drawLine();
      //
      // this.drawPiece(0, 0, true);
      // this.drawPiece(1, 1, false);
    }.bind(this);
  },
  draw: function draw(width, height) {
    width = width || 450;
    height = height || 450;

    this.context.strokeStyle = "#BFBFBF";

    // this.context.moveTo(0, 0);
    // this.context.lineTo(width, height);
    // this.context.stroke();

    // for (let i=0; i<15; ++i) {
    //   // 横线
    //   this.context.moveTo(15, 15+30*i);
    //   this.context.lineTo(435, 15+30*i);
    //   this.context.stroke();
    //
    //   // 纵线
    //   this.context.moveTo(15 + 30*i, 15);
    //   this.context.lineTo(15 + 30*i, 435);
    //   this.context.stroke();
    // }

    // load background image
    this.loadBackground();
  },
  // Event
  onclick: function onclick(e) {
    // 下棋结束 或者 不是我方(黑棋)下棋
    if (this.over || !this.pieceColor) return;

    var x = e.offsetX,
        y = e.offsetY;

    var i = Math.floor(x / 30),
        j = Math.floor(y / 30);

    if (this.chessBoard[i][j] !== 0) {
      alert("不能覆盖棋子!");
      return;
    }

    // this.chessBoard[i][j] = this.pieceColor ? 1 : 2; // 黑棋为1, 白棋为2
    this.chessBoard[i][j] = 1;
    this.drawPiece(i, j, this.pieceColor);
    // this.pieceColor = ! this.pieceColor;

    this.judge(i, j);
  },
  // AI
  judge: function judge(i, j) {
    for (var k = 0; k < this.count; ++k) {
      if (this.wins[i][j][k]) {
        this.myWin[k]++;
        this.computerWin[k] = 6; // 异常，computer不可能赢
        if (this.myWin[k] === 5) {
          window.alert("你赢了");
          this.over = true;
        }
      }
    }

    if (!this.over) {
      this.pieceColor = !this.pieceColor;
      this.computerAI();
    }
  },
  //
  computerAI: function computerAI() {
    var myScore = [],
        computerScore = [];

    var max = 0;
    var u = 0,
        v = 0;

    for (var i = 0; i < 15; ++i) {
      myScore[i] = [];
      computerScore[i] = [];
      for (var j = 0; j < 15; j++) {
        myScore[i][j] = 0;
        computerScore[i][j] = 0;
      }
    }

    for (var i = 0; i < 15; ++i) {
      for (var j = 0; j < 15; j++) {
        if (this.chessBoard[i][j] == 0) {
          for (var k = 0; k < this.count; k++) {
            if (this.wins[i][j][k]) {
              switch (this.myWin[k]) {
                case 1:
                  myScore[i][j] += 200;
                  break;
                case 2:
                  myScore[i][j] += 400;
                  break;
                case 3:
                  myScore[i][j] += 1000;
                  break;
                case 4:
                  myScore[i][j] += 10000;
                  break;
              }

              switch (this.computerWin[k]) {
                case 1:
                  computerScore[i][j] += 220;
                  break;
                case 2:
                  computerScore[i][j] += 420;
                  break;
                case 3:
                  computerScore[i][j] += 2000;
                  break;
                case 4:
                  computerScore[i][j] += 20000;
                  break;
              }
            }
          }

          if (myScore[i][j] > max) {
            max = myScore[i][j];
            u = i;
            v = j;
          } else if (myScore[i][j] == max) {
            if (computerScore[i][j] > computerScore[u][v]) {
              u = i;
              v = j;
            }
          }

          if (computerScore[i][j] > max) {
            max = computerScore[i][j];
            u = i;
            v = j;
          } else if (computerScore[i][j] == max) {
            if (myScore[i][j] > myScore[u][v]) {
              u = i;
              v = j;
            }
          }
        }
      }
    }

    this.drawPiece(u, v, false);
    this.chessBoard[u][v] = 2;

    for (var k = 0; k < this.count; ++k) {
      if (this.wins[u][v][k]) {
        this.computerWin[k]++;
        this.myWin[k] = 6; // 异常，computer不可能赢
        if (this.computerWin[k] === 5) {
          window.alert("AI赢了");
          this.over = true;
        }
      }
    }

    if (!this.over) {
      this.pieceColor = !this.pieceColor;
    }
  }
};

new Chess(".chess").init(450, 450);
//# sourceMappingURL=data:application/json;base64,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QyxrQkFBSSxDQUFKLENBRmlDO2FBQW5DO1dBREs7U0FsRFQ7T0FERjtLQURGOztBQThEQSxTQUFLLFNBQUwsQ0FBZSxDQUFmLEVBQWtCLENBQWxCLEVBQXFCLEtBQXJCLEVBL0VzQjtBQWdGdEIsU0FBSyxVQUFMLENBQWdCLENBQWhCLEVBQW1CLENBQW5CLElBQXdCLENBQXhCLENBaEZzQjs7QUFrRnRCLFNBQUssSUFBSSxJQUFFLENBQUYsRUFBSyxJQUFFLEtBQUssS0FBTCxFQUFZLEVBQUUsQ0FBRixFQUFLO0FBQzlCLFVBQUksS0FBSyxJQUFMLENBQVUsQ0FBVixFQUFhLENBQWIsRUFBZ0IsQ0FBaEIsQ0FBSixFQUF3QjtBQUN2QixhQUFLLFdBQUwsQ0FBaUIsQ0FBakIsSUFEdUI7QUFFdkIsYUFBSyxLQUFMLENBQVcsQ0FBWCxJQUFnQixDQUFoQjtBQUZ1QixZQUduQixLQUFLLFdBQUwsQ0FBaUIsQ0FBakIsTUFBd0IsQ0FBeEIsRUFBMkI7QUFDN0IsaUJBQU8sS0FBUCxDQUFhLE1BQWIsRUFENkI7QUFFN0IsZUFBSyxJQUFMLEdBQVksSUFBWixDQUY2QjtTQUEvQjtPQUhEO0tBREg7O0FBV0EsUUFBSSxDQUFDLEtBQUssSUFBTCxFQUFXO0FBQ2QsV0FBSyxVQUFMLEdBQWtCLENBQUUsS0FBSyxVQUFMLENBRE47S0FBaEI7R0E3RlU7Q0EzTGQ7O0FBK1JBLElBQUksS0FBSixDQUFVLFFBQVYsRUFBb0IsSUFBcEIsQ0FBeUIsR0FBekIsRUFBOEIsR0FBOUIiLCJmaWxlIjoiZ29iYW5nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG5gICogZWw6IGNhbnZhc1xuICAqL1xuZnVuY3Rpb24gQ2hlc3MoZWwpIHtcbiAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsKTtcbiAgdGhpcy5waWVjZUNvbG9yID0gdHJ1ZTsgLy8g5qOL5a2Q6aKc6ImyOiB0cnVlIOS4uum7keiJsiwgZmFsc2Ug5Li655m96ImyXG4gIHRoaXMuY2hlc3NCb2FyZCA9IFtdO1xuICAvLyBBSVxuICB0aGlzLndpbnMgPSBbXTsgLy8g6LWi5rOV5pWw57uEXG4gIHRoaXMuY291bnQgPSAwOyAvLyDotaLms5Xnp43nsbtcbiAgLy8gQUkg6LWi5rOV55qE57uf6K6h5pWw57uEXG4gIHRoaXMubXlXaW4gPSBbXTtcbiAgdGhpcy5jb21wdXRlcldpbiA9IFtdO1xuICAvLyDkuIvmo4vmmK/lkKbkuIvlroxcbiAgdGhpcy5vdmVyID0gZmFsc2U7XG5cbiAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgdGhpcy5jYW52YXMub25jbGljayA9IHRoaXMub25jbGljay5iaW5kKHRoaXMpO1xufVxuXG5DaGVzcy5wcm90b3R5cGUgPSB7XG4gIGluaXQ6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgZm9yICh2YXIgaT0wOyBpPDE1OyArK2kpIHtcbiAgICAgIHRoaXMuY2hlc3NCb2FyZFtpXSA9IFtdO1xuICAgICAgZm9yICh2YXIgaj0wOyBqPDE1OyBqKyspIHtcbiAgICAgICAgdGhpcy5jaGVzc0JvYXJkW2ldW2pdID0gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDotaLms5XmlbDnu4TliJ3lp4vljJZcbiAgICBmb3IgKHZhciBpPTA7IGk8MTU7ICsraSkge1xuICAgICAgdGhpcy53aW5zW2ldID0gW107XG4gICAgICBmb3IgKHZhciBqPTA7IGo8MTU7ICsraikge1xuICAgICAgICB0aGlzLndpbnNbaV1bal0gPSBbXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmqKrnur9cbiAgICBmb3IgKHZhciBpPTA7IGk8MTU7ICsraSkge1xuICAgICAgZm9yICh2YXIgaj0wOyBqPDExOyArK2opIHtcbiAgICAgICAgLy8gd2luc1swXVswXVswXSA9IHRydWVcbiAgICAgICAgLy8gd2luc1swXVsxXVswXSA9IHRydWVcbiAgICAgICAgLy8gd2luc1swXVsyXVswXSA9IHRydWVcbiAgICAgICAgLy8gd2luc1swXVszXVswXSA9IHRydWVcbiAgICAgICAgLy8gd2luc1swXVs0XVswXSA9IHRydWVcblxuICAgICAgICAvLyB3aW5zWzBdWzFdWzFdID0gdHJ1ZVxuICAgICAgICAvLyB3aW5zWzBdWzJdWzFdID0gdHJ1ZVxuICAgICAgICAvLyB3aW5zWzBdWzNdWzFdID0gdHJ1ZVxuICAgICAgICAvLyB3aW5zWzBdWzRdWzFdID0gdHJ1ZVxuICAgICAgICAvLyB3aW5zWzBdWzVdWzFdID0gdHJ1ZVxuICAgICAgICBmb3IgKHZhciBrPTA7IGs8NTsgKytrKSB7XG4gICAgICAgICAgdGhpcy53aW5zW2ldW2ora11bdGhpcy5jb3VudF0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY291bnQgKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g56uW57q/XG4gICAgZm9yICh2YXIgaT0wOyBpPDE1OyArK2kpIHtcbiAgICAgIGZvciAodmFyIGo9MDsgajwxMTsgKytqKSB7XG4gICAgICAgIGZvciAodmFyIGs9MDsgazw1OyArK2spIHtcbiAgICAgICAgICB0aGlzLndpbnNbaitrXVtpXVt0aGlzLmNvdW50XSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb3VudCArKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDmlpznur9cbiAgICBmb3IgKHZhciBpPTA7IGk8MTE7ICsraSkge1xuICAgICAgZm9yICh2YXIgaj0wOyBqPDExOyArK2opIHtcbiAgICAgICAgZm9yICh2YXIgaz0wOyBrPDU7ICsraykge1xuICAgICAgICAgIHRoaXMud2luc1tpK2tdW2ora11bdGhpcy5jb3VudF0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY291bnQgKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5Y+N5pac57q/XG4gICAgZm9yICh2YXIgaT0wOyBpPDExOyArK2kpIHtcbiAgICAgIGZvciAodmFyIGo9MTQ7IGo+Mzsgai0tKSB7XG4gICAgICAgIGZvciAodmFyIGs9MDsgazw1OyArK2spIHtcbiAgICAgICAgICB0aGlzLndpbnNbaStrXVtqLWtdW3RoaXMuY291bnRdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvdW50ICsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOe7n+iuoeaVsOe7hOWIneWni+WMllxuICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLmNvdW50OyArK2kpIHtcbiAgICAgIHRoaXMubXlXaW5baV0gPSAwO1xuICAgICAgdGhpcy5jb21wdXRlcldpbltpXSA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5kcmF3KCk7XG4gIH0sXG5cbiAgZHJhd0xpbmU6IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBpPTA7IGk8MTU7ICsraSkge1xuICAgICAgLy8g5qiq57q/XG4gICAgICB0aGlzLmNvbnRleHQubW92ZVRvKDE1LCAxNSszMCppKTtcbiAgICAgIHRoaXMuY29udGV4dC5saW5lVG8oNDM1LCAxNSszMCppKTtcbiAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcblxuICAgICAgLy8g57q157q/XG4gICAgICB0aGlzLmNvbnRleHQubW92ZVRvKDE1ICsgMzAqaSwgMTUpO1xuICAgICAgdGhpcy5jb250ZXh0LmxpbmVUbygxNSArIDMwKmksIDQzNSk7XG4gICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgfVxuICB9LFxuICBkcmF3UGllY2U6IGZ1bmN0aW9uIChpLCBqLCBtZSkge1xuICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICB0aGlzLmNvbnRleHQuYXJjKDE1ICsgMzAqaSwgMTUgKyAzMCpqLCAxMywgMCwgMipNYXRoLlBJKTtcbiAgICB0aGlzLmNvbnRleHQuY2xvc2VQYXRoKCk7XG4gICAgdmFyIGdyYWRpZW50ID0gdGhpcy5jb250ZXh0LmNyZWF0ZVJhZGlhbEdyYWRpZW50KDE1ICsgMzAqaSsyLCAxNSArIDMwKmotMiwgMTMsIDE1ICsgMzAqaSwgMTUgKyAzMCpqLCAwKTtcbiAgICBpZiAobWUpIHtcbiAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCAnIzBBMEEwQScpO1xuICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICcjNjM2NzY2Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCAnI0QxRDFEMScpO1xuICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICcjRjlGOUY5Jyk7XG4gICAgfVxuXG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IGdyYWRpZW50O1xuICAgIHRoaXMuY29udGV4dC5maWxsKCk7XG4gIH0sXG4gIGxvYWRCYWNrZ3JvdW5kOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgdmFyIGJnID0gbmV3IEltYWdlKCk7XG4gICAgYmcuc3JjID0gdXJsIHx8IFwiaW1hZ2VzL2JnLmpwZ1wiO1xuICAgIGJnLnN0eWxlLm9wYWNpdHkgPSBcIjFcIjtcbiAgICAvLyBiZy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgIGJnLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UoYmcsIDAsIDAsIDQ1MCwgNDUwKTtcblxuICAgICAgdGhpcy5kcmF3TGluZSgpO1xuICAgICAgLy9cbiAgICAgIC8vIHRoaXMuZHJhd1BpZWNlKDAsIDAsIHRydWUpO1xuICAgICAgLy8gdGhpcy5kcmF3UGllY2UoMSwgMSwgZmFsc2UpO1xuICAgIH0uYmluZCh0aGlzKTtcbiAgfSxcbiAgZHJhdzogZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHtcbiAgICB3aWR0aCA9IHdpZHRoIHx8IDQ1MDtcbiAgICBoZWlnaHQgPSBoZWlnaHQgfHwgNDUwO1xuXG4gICAgdGhpcy5jb250ZXh0LnN0cm9rZVN0eWxlID0gXCIjQkZCRkJGXCI7XG5cbiAgICAvLyB0aGlzLmNvbnRleHQubW92ZVRvKDAsIDApO1xuICAgIC8vIHRoaXMuY29udGV4dC5saW5lVG8od2lkdGgsIGhlaWdodCk7XG4gICAgLy8gdGhpcy5jb250ZXh0LnN0cm9rZSgpO1xuXG4gICAgLy8gZm9yIChsZXQgaT0wOyBpPDE1OyArK2kpIHtcbiAgICAvLyAgIC8vIOaoque6v1xuICAgIC8vICAgdGhpcy5jb250ZXh0Lm1vdmVUbygxNSwgMTUrMzAqaSk7XG4gICAgLy8gICB0aGlzLmNvbnRleHQubGluZVRvKDQzNSwgMTUrMzAqaSk7XG4gICAgLy8gICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgLy9cbiAgICAvLyAgIC8vIOe6tee6v1xuICAgIC8vICAgdGhpcy5jb250ZXh0Lm1vdmVUbygxNSArIDMwKmksIDE1KTtcbiAgICAvLyAgIHRoaXMuY29udGV4dC5saW5lVG8oMTUgKyAzMCppLCA0MzUpO1xuICAgIC8vICAgdGhpcy5jb250ZXh0LnN0cm9rZSgpO1xuICAgIC8vIH1cblxuICAgIC8vIGxvYWQgYmFja2dyb3VuZCBpbWFnZVxuICAgIHRoaXMubG9hZEJhY2tncm91bmQoKTtcbiAgfSxcbiAgLy8gRXZlbnRcbiAgb25jbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICAvLyDkuIvmo4vnu5PmnZ8g5oiW6ICFIOS4jeaYr+aIkeaWuSjpu5Hmo4sp5LiL5qOLXG4gICAgaWYgKHRoaXMub3ZlciB8fCAhdGhpcy5waWVjZUNvbG9yKSByZXR1cm4gO1xuXG4gICAgdmFyIHggPSBlLm9mZnNldFgsXG4gICAgICAgIHkgPSBlLm9mZnNldFk7XG5cbiAgICB2YXIgaSA9IE1hdGguZmxvb3IoeCAvIDMwKSxcbiAgICAgICAgaiA9IE1hdGguZmxvb3IoeSAvIDMwKTtcblxuICAgIGlmICh0aGlzLmNoZXNzQm9hcmRbaV1bal0gIT09IDApIHtcbiAgICAgIGFsZXJ0KFwi5LiN6IO96KaG55uW5qOL5a2QIVwiKTtcbiAgICAgIHJldHVybiA7XG4gICAgfVxuXG4gICAgLy8gdGhpcy5jaGVzc0JvYXJkW2ldW2pdID0gdGhpcy5waWVjZUNvbG9yID8gMSA6IDI7IC8vIOm7keaji+S4ujEsIOeZveaji+S4ujJcbiAgICB0aGlzLmNoZXNzQm9hcmRbaV1bal0gPSAxO1xuICAgIHRoaXMuZHJhd1BpZWNlKGksIGosIHRoaXMucGllY2VDb2xvcik7XG4gICAgLy8gdGhpcy5waWVjZUNvbG9yID0gISB0aGlzLnBpZWNlQ29sb3I7XG5cbiAgICB0aGlzLmp1ZGdlKGksIGopO1xuICB9LFxuICAvLyBBSVxuICBqdWRnZTogZnVuY3Rpb24gKGksIGopIHtcbiAgICBmb3IgKHZhciBrPTA7IGs8dGhpcy5jb3VudDsgKytrKSB7XG4gICAgICAgaWYgKHRoaXMud2luc1tpXVtqXVtrXSkge1xuICAgICAgICB0aGlzLm15V2luW2tdKys7XG4gICAgICAgIHRoaXMuY29tcHV0ZXJXaW5ba10gPSA2OyAvLyDlvILluLjvvIxjb21wdXRlcuS4jeWPr+iDvei1olxuICAgICAgICBpZiAodGhpcy5teVdpbltrXSA9PT0gNSkge1xuICAgICAgICAgIHdpbmRvdy5hbGVydChcIuS9oOi1ouS6hlwiKTtcbiAgICAgICAgICB0aGlzLm92ZXIgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm92ZXIpIHtcbiAgICAgIHRoaXMucGllY2VDb2xvciA9ICEgdGhpcy5waWVjZUNvbG9yO1xuICAgICAgdGhpcy5jb21wdXRlckFJKCk7XG4gICAgfVxuICB9LFxuICAvL1xuICBjb21wdXRlckFJOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG15U2NvcmUgPSBbXSxcbiAgICAgIGNvbXB1dGVyU2NvcmUgPSBbXTtcblxuICAgIHZhciBtYXggPSAwO1xuICAgIHZhciB1PTAsXG4gICAgICAgIHY9MDtcblxuICAgIGZvciAodmFyIGk9MDsgaTwxNTsgKytpKSB7XG4gICAgICBteVNjb3JlW2ldID0gW107XG4gICAgICBjb21wdXRlclNjb3JlW2ldID0gW107XG4gICAgICBmb3IgKHZhciBqPTA7IGo8MTU7IGorKykge1xuICAgICAgICBteVNjb3JlW2ldW2pdID0gMDtcbiAgICAgICAgY29tcHV0ZXJTY29yZVtpXVtqXSA9IDA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaT0wOyBpPDE1OyArK2kpIHtcbiAgICAgIGZvciAodmFyIGo9MDsgajwxNTsgaisrKSB7XG4gICAgICAgIGlmICh0aGlzLmNoZXNzQm9hcmRbaV1bal0gPT0gMCkge1xuICAgICAgICAgIGZvciAodmFyIGs9MDsgazx0aGlzLmNvdW50OyBrKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLndpbnNbaV1bal1ba10pIHtcbiAgICAgICAgICAgICAgc3dpdGNoKHRoaXMubXlXaW5ba10pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICBteVNjb3JlW2ldW2pdICs9IDIwMDtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgIG15U2NvcmVbaV1bal0gKz0gNDAwO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgbXlTY29yZVtpXVtqXSArPSAxMDAwO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgbXlTY29yZVtpXVtqXSArPSAxMDAwMDtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgc3dpdGNoKHRoaXMuY29tcHV0ZXJXaW5ba10pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICBjb21wdXRlclNjb3JlW2ldW2pdICs9IDIyMDtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgIGNvbXB1dGVyU2NvcmVbaV1bal0gKz0gNDIwO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgY29tcHV0ZXJTY29yZVtpXVtqXSArPSAyMDAwO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgY29tcHV0ZXJTY29yZVtpXVtqXSArPSAyMDAwMDtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG15U2NvcmVbaV1bal0gPiBtYXgpIHtcbiAgICAgICAgICAgIG1heCA9IG15U2NvcmVbaV1bal07XG4gICAgICAgICAgICB1ID0gaTtcbiAgICAgICAgICAgIHYgPSBqO1xuICAgICAgICAgIH0gZWxzZSBpZiAobXlTY29yZVtpXVtqXSA9PSBtYXgpIHtcbiAgICAgICAgICAgIGlmIChjb21wdXRlclNjb3JlW2ldW2pdID4gY29tcHV0ZXJTY29yZVt1XVt2XSkge1xuICAgICAgICAgICAgICB1ID0gaTtcbiAgICAgICAgICAgICAgdiA9IGo7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGNvbXB1dGVyU2NvcmVbaV1bal0gPiBtYXgpIHtcbiAgICAgICAgICAgIG1heCA9IGNvbXB1dGVyU2NvcmVbaV1bal07XG4gICAgICAgICAgICB1ID0gaTtcbiAgICAgICAgICAgIHYgPSBqO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY29tcHV0ZXJTY29yZVtpXVtqXSA9PSBtYXgpIHtcbiAgICAgICAgICAgIGlmIChteVNjb3JlW2ldW2pdID4gbXlTY29yZVt1XVt2XSkge1xuICAgICAgICAgICAgICB1ID0gaTtcbiAgICAgICAgICAgICAgdiA9IGo7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5kcmF3UGllY2UodSwgdiwgZmFsc2UpO1xuICAgIHRoaXMuY2hlc3NCb2FyZFt1XVt2XSA9IDI7XG5cbiAgICBmb3IgKHZhciBrPTA7IGs8dGhpcy5jb3VudDsgKytrKSB7XG4gICAgICAgaWYgKHRoaXMud2luc1t1XVt2XVtrXSkge1xuICAgICAgICB0aGlzLmNvbXB1dGVyV2luW2tdKys7XG4gICAgICAgIHRoaXMubXlXaW5ba10gPSA2OyAvLyDlvILluLjvvIxjb21wdXRlcuS4jeWPr+iDvei1olxuICAgICAgICBpZiAodGhpcy5jb21wdXRlcldpbltrXSA9PT0gNSkge1xuICAgICAgICAgIHdpbmRvdy5hbGVydChcIkFJ6LWi5LqGXCIpO1xuICAgICAgICAgIHRoaXMub3ZlciA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRoaXMub3Zlcikge1xuICAgICAgdGhpcy5waWVjZUNvbG9yID0gISB0aGlzLnBpZWNlQ29sb3I7XG4gICAgfVxuICB9LFxufTtcblxuXG5uZXcgQ2hlc3MoXCIuY2hlc3NcIikuaW5pdCg0NTAsIDQ1MCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
