'use strict';

function $(el) {
  return document.querySelector(el);
}

function BTree(el) {
  this._isRunning = false;
  this._root = document.querySelector(el);
  this._index = 0;
  this._steps = [];
  this._it = undefined;
}

BTree.prototype = {
  constructor: BTree,

  // 根据选择的遍历方法遍历
  traverse: function traverse(process, method) {
    method = method || 'preOrder';

    // 前序遍历
    function preOrder(node) {
      if (node === null) return;

      process.call(this, node);

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        preOrder(e);
      });
    }

    function inOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    // 后序遍历
    function postOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    switch (method) {
      case 'preOrder':
        preOrder(this._root);
        break;
      case 'inOrder':
        inOrder(this._root);
        break;
      case 'postOrder':
        postOrder(this._root);
        break;
    }
  },

  clear: function clear() {
    this.traverse(function (node) {
      node.style.backgroundColor = "#FFF";
    });
  },

  toArray: function toArray(method) {
    var _ = [];
    this.traverse(function (node) {
      _.push(node);
    }, method);
    return _;
  },

  init: function init(method) {
    this._steps = this.toArray(method);
  },

  run: function run(method, speed, callback) {
    if (this._isRunning) return;

    this._isRunning = true;

    var self = this;
    this._it = setInterval(cycle(), speed || 1000);

    // 闭包
    // cycle 函数只被执行一次
    function cycle() {
      var index = 0;
      var _ = self.toArray(method);
      // var _ = self._steps;

      return function () {
        if (index === _.length) {
          clearInterval(self._it);
          self._it = undefined;
          self._isRunning = false;
          callback();
        }

        if (index !== 0) _[index - 1].style.backgroundColor = '#FFF';

        if (index != _.length) _[index].style.backgroundColor = '#000';

        index += 1;
      };
    }
  },

  stop: function stop() {
    this.clear();
    this._index = 0; // reset index

    if (this._it) {
      this._isRunning = false;
      clearInterval(this._it);
      this._it = undefined;
    }
  },

  next: function next(method, callback) {
    this._steps = this.toArray(method);
    if (this._index !== 0) this._steps[this._index - 1].style.backgroundColor = "#FFF";

    if (this._index !== this._steps.length) {
      this._steps[this._index++].style.backgroundColor = "#000";
    } else {
      this._index = 0; // reset index
      callback();
    }
  },

  search: function search(method, callback) {
    this.traverse(callback, method);
  }
};

function reset() {
  if ($(".btn.stop")) {
    $(".btn.stop").innerText = '运行';
    $(".btn.stop").className = 'btn run';
    $(".btn.debug").innerText = '单步调试';
  }
}

function getMethod() {
  var _options = $('#method').children;
  return Array.prototype.filter.call(_options, function (e) {
    if (e.selected) return e.value;
  })[0].value;
}

function getSearchText() {
  return $("#search-text").value.trim();
}

function Tree() {
  var oo = new BTree(".container");

  return {
    run: function run(el) {
      $(".btn.debug").disabled = "disabled";
      el.innerText = "停止";
      el.className = "btn stop";
      oo.run(getMethod(), 1000, function () {
        $(".btn.debug").disabled = "";
        el.innerText = "运行";
      });
    },
    stop: function stop(el) {
      $(".btn.debug").disabled = "";
      el.innerText = "运行";
      el.className = "btn run";
      $(".btn.debug").innerText = "单步调试";
      oo.stop();
    },
    debug: function debug(el) {
      if ($(".btn.run")) {
        el.innerText = '下一步';
        $(".btn.run").innerText = "停止";
        $(".btn.run").className = "btn stop";
      }
      oo.next(getMethod(), function () {
        el.innerText = '单步调试';
      });
    },
    search: function search() {
      oo.clear();
      var searchText = getSearchText();
      oo.search(getMethod(), function (node) {
        if (node.childNodes[0].textContent.trim() === searchText) {
          node.style.backgroundColor = '#F00';
        }
      });
    }
  };
}

var treeObj = Tree();

addEventListener("click", function (e) {
  e = e || window.event;
  var el = e.srcElement || e.target;

  switch (el.className) {
    case 'btn run':
      treeObj.run(el);
      break;
    case 'btn stop':
      treeObj.stop(el);
      break;
    case 'btn debug':
      treeObj.debug(el);
      break;
    case 'methods':
      treeObj.stop($(".btn.stop") || $(".btn.run"));
      // reset();
      break;
    case 'btn search':
      treeObj.search();
      break;
  }
});
//# sourceMappingURL=data:application/json;base64,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QUNsQixTQUFHLEtBQUgsR0FEa0I7QUFFbEIsVUFBSSxhQUFhLGVBQWIsQ0FGYztBQUdsQixTQUFHLE1BQUgsQ0FBVSxXQUFWLEVBQXVCLFVBQVUsSUFBVixFQUFnQjtBQUNyQyxZQUFJLEtBQUssVUFBTCxDQUFnQixDQUFoQixFQUFtQixXQUFuQixDQUErQixJQUEvQixPQUEwQyxVQUExQyxFQUFzRDtBQUN4RCxlQUFLLEtBQUwsQ0FBVyxlQUFYLEdBQTZCLE1BQTdCLENBRHdEO1NBQTFEO09BRHFCLENBQXZCLENBSGtCO0tBQVo7R0EzQlYsQ0FIWTtDQUFoQjs7QUEwQ0EsSUFBSSxVQUFVLE1BQVY7O0FBRUosaUJBQWlCLE9BQWpCLEVBQTBCLFVBQVUsQ0FBVixFQUFhO0FBQ3JDLE1BQUksS0FBSyxPQUFPLEtBQVAsQ0FENEI7QUFFckMsTUFBSSxLQUFLLEVBQUUsVUFBRixJQUFnQixFQUFFLE1BQUYsQ0FGWTs7QUFJckMsVUFBTyxHQUFHLFNBQUg7QUFDTCxTQUFLLFNBQUw7QUFDRSxjQUFRLEdBQVIsQ0FBWSxFQUFaLEVBREY7QUFFRSxZQUZGO0FBREYsU0FJTyxVQUFMO0FBQ0UsY0FBUSxJQUFSLENBQWEsRUFBYixFQURGO0FBRUUsWUFGRjtBQUpGLFNBT08sV0FBTDtBQUNFLGNBQVEsS0FBUixDQUFjLEVBQWQsRUFERjtBQUVFLFlBRkY7QUFQRixTQVVPLFNBQUw7QUFDRSxjQUFRLElBQVIsQ0FBYSxFQUFFLFdBQUYsS0FBa0IsRUFBRSxVQUFGLENBQWxCLENBQWI7O0FBREY7QUFWRixTQWNPLFlBQUw7QUFDRSxjQUFRLE1BQVIsR0FERjtBQUVFLFlBRkY7QUFkRixHQUpxQztDQUFiLENBQTFCIiwiZmlsZSI6InRhc2stMjMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiAkIChlbCkge1xuICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbCk7XG59XG5cbmZ1bmN0aW9uIEJUcmVlKGVsKSB7XG4gIHRoaXMuX2lzUnVubmluZyA9IGZhbHNlO1xuICB0aGlzLl9yb290ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbCk7XG4gIHRoaXMuX2luZGV4ID0gMDtcbiAgdGhpcy5fc3RlcHMgPSBbXTtcbiAgdGhpcy5faXQgPSB1bmRlZmluZWQ7XG59XG5cbkJUcmVlLnByb3RvdHlwZSA9IHtcbiAgY29uc3RydWN0b3I6IEJUcmVlLFxuXG4gIC8vIOagueaNrumAieaLqeeahOmBjeWOhuaWueazlemBjeWOhlxuICB0cmF2ZXJzZTogZnVuY3Rpb24gKHByb2Nlc3MsIG1ldGhvZCkge1xuICAgIG1ldGhvZCA9IG1ldGhvZCB8fCAncHJlT3JkZXInO1xuXG4gICAgLy8g5YmN5bqP6YGN5Y6GXG4gICAgZnVuY3Rpb24gcHJlT3JkZXIobm9kZSkge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwpIHJldHVybiA7XG5cbiAgICAgIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTtcblxuICAgICAgLy8g6L+Z5piv5LqM5Y+J5qCR5LiO5aSa5Y+J5qCR55qE5Yy65YirOiDlpJrkuKrlrZDoioLngrlcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcHJlT3JkZXIoZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbk9yZGVyKG5vZGUpIHtcbiAgICAgIGlmIChub2RlID09PSBudWxsKSByZXR1cm4gO1xuXG4gICAgICAvLyDov5nmmK/kuozlj4nmoJHkuI7lpJrlj4nmoJHnmoTljLrliKs6IOWkmuS4quWtkOiKgueCuVxuICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChub2RlLmNoaWxkcmVuLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBwb3N0T3JkZXIoZSk7XG4gICAgICB9KTtcblxuICAgICAgcHJvY2Vzcy5jYWxsKHRoaXMsIG5vZGUpO1xuICAgIH1cblxuICAgIC8vIOWQjuW6j+mBjeWOhlxuICAgIGZ1bmN0aW9uIHBvc3RPcmRlcihub2RlKSB7XG4gICAgICBpZiAobm9kZSA9PT0gbnVsbCkgcmV0dXJuIDtcblxuICAgICAgLy8g6L+Z5piv5LqM5Y+J5qCR5LiO5aSa5Y+J5qCR55qE5Yy65YirOiDlpJrkuKrlrZDoioLngrlcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcG9zdE9yZGVyKGUpO1xuICAgICAgfSk7XG5cbiAgICAgIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTtcbiAgICB9XG5cbiAgICBzd2l0Y2gobWV0aG9kKSB7XG4gICAgICBjYXNlICdwcmVPcmRlcic6XG4gICAgICAgIHByZU9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2luT3JkZXInOlxuICAgICAgICBpbk9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3Bvc3RPcmRlcic6XG4gICAgICAgIHBvc3RPcmRlcih0aGlzLl9yb290KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9LFxuXG4gIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy50cmF2ZXJzZShmdW5jdGlvbiAobm9kZSkge1xuICAgICAgbm9kZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNGRkZcIjtcbiAgICB9KTtcbiAgfSxcblxuICB0b0FycmF5OiBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgdmFyIF8gPSBbXTtcbiAgICB0aGlzLnRyYXZlcnNlKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICBfLnB1c2gobm9kZSk7XG4gICAgfSwgbWV0aG9kKTtcbiAgICByZXR1cm4gXztcbiAgfSxcblxuICBpbml0OiBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgdGhpcy5fc3RlcHMgPSB0aGlzLnRvQXJyYXkobWV0aG9kKTtcbiAgfSxcblxuICBydW46IGZ1bmN0aW9uIChtZXRob2QsIHNwZWVkLCBjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLl9pc1J1bm5pbmcpIHJldHVybiA7XG5cbiAgICB0aGlzLl9pc1J1bm5pbmcgPSB0cnVlO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuX2l0ID0gc2V0SW50ZXJ2YWwoY3ljbGUoKSwgc3BlZWQgfHwgMTAwMCk7XG5cbiAgICAvLyDpl63ljIVcbiAgICAvLyBjeWNsZSDlh73mlbDlj6rooqvmiafooYzkuIDmrKFcbiAgICBmdW5jdGlvbiBjeWNsZSgpIHtcbiAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICB2YXIgXyA9IHNlbGYudG9BcnJheShtZXRob2QpO1xuICAgICAgLy8gdmFyIF8gPSBzZWxmLl9zdGVwcztcblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGluZGV4ID09PSBfLmxlbmd0aCkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2VsZi5faXQpO1xuICAgICAgICAgIHNlbGYuX2l0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgIHNlbGYuX2lzUnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5kZXggIT09IDApXG4gICAgICAgICAgX1tpbmRleC0xXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGRic7XG5cbiAgICAgICAgaWYgKGluZGV4ICE9IF8ubGVuZ3RoKVxuICAgICAgICBfW2luZGV4XS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnIzAwMCc7XG5cbiAgICAgICAgaW5kZXggKz0gMTtcbiAgICAgIH07XG4gICAgfVxuICB9LFxuXG4gIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgdGhpcy5faW5kZXggPSAwOyAvLyByZXNldCBpbmRleFxuXG4gICAgaWYgKHRoaXMuX2l0KSB7XG4gICAgICB0aGlzLl9pc1J1bm5pbmcgPSBmYWxzZTtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faXQpO1xuICAgICAgdGhpcy5faXQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9LFxuXG4gIG5leHQ6IGZ1bmN0aW9uIChtZXRob2QsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fc3RlcHMgPSB0aGlzLnRvQXJyYXkobWV0aG9kKTtcbiAgICBpZiAodGhpcy5faW5kZXggIT09IDApXG4gICAgICB0aGlzLl9zdGVwc1t0aGlzLl9pbmRleC0xXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNGRkZcIjtcblxuICAgIGlmICh0aGlzLl9pbmRleCAhPT0gdGhpcy5fc3RlcHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9zdGVwc1t0aGlzLl9pbmRleCsrXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiMwMDBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faW5kZXggPSAwOyAvLyByZXNldCBpbmRleFxuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH0sXG5cbiAgc2VhcmNoOiBmdW5jdGlvbiAobWV0aG9kLCBjYWxsYmFjaykge1xuICAgIHRoaXMudHJhdmVyc2UoY2FsbGJhY2ssIG1ldGhvZCk7XG4gIH0sXG59O1xuXG5cbmZ1bmN0aW9uIHJlc2V0KCkge1xuICBpZiAoJChcIi5idG4uc3RvcFwiKSkge1xuICAgICQoXCIuYnRuLnN0b3BcIikuaW5uZXJUZXh0ID0gJ+i/kOihjCc7XG4gICAgJChcIi5idG4uc3RvcFwiKS5jbGFzc05hbWUgPSAnYnRuIHJ1bic7XG4gICAgJChcIi5idG4uZGVidWdcIikuaW5uZXJUZXh0ID0gJ+WNleatpeiwg+ivlSc7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0TWV0aG9kKCkge1xuICB2YXIgX29wdGlvbnMgPSAkKCcjbWV0aG9kJykuY2hpbGRyZW47XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuZmlsdGVyLmNhbGwoX29wdGlvbnMsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUuc2VsZWN0ZWQpIHJldHVybiBlLnZhbHVlO1xuICB9KVswXS52YWx1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0U2VhcmNoVGV4dCgpIHtcbiAgcmV0dXJuICQoXCIjc2VhcmNoLXRleHRcIikudmFsdWUudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBUcmVlKCkge1xuICAgIHZhciBvbyA9IG5ldyBCVHJlZShcIi5jb250YWluZXJcIik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcnVuOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgJChcIi5idG4uZGVidWdcIikuZGlzYWJsZWQgPSBcImRpc2FibGVkXCI7XG4gICAgICAgIGVsLmlubmVyVGV4dCA9IFwi5YGc5q2iXCI7XG4gICAgICAgIGVsLmNsYXNzTmFtZSA9IFwiYnRuIHN0b3BcIjtcbiAgICAgICAgb28ucnVuKGdldE1ldGhvZCgpLCAxMDAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJChcIi5idG4uZGVidWdcIikuZGlzYWJsZWQgPSBcIlwiO1xuICAgICAgICAgIGVsLmlubmVyVGV4dCA9IFwi6L+Q6KGMXCI7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHN0b3A6IGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAkKFwiLmJ0bi5kZWJ1Z1wiKS5kaXNhYmxlZCA9IFwiXCI7XG4gICAgICAgIGVsLmlubmVyVGV4dCA9IFwi6L+Q6KGMXCI7XG4gICAgICAgIGVsLmNsYXNzTmFtZSA9IFwiYnRuIHJ1blwiO1xuICAgICAgICAkKFwiLmJ0bi5kZWJ1Z1wiKS5pbm5lclRleHQgPSBcIuWNleatpeiwg+ivlVwiO1xuICAgICAgICBvby5zdG9wKCk7XG4gICAgICB9LFxuICAgICAgZGVidWc6IGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBpZiAoJChcIi5idG4ucnVuXCIpKSB7XG4gICAgICAgICAgZWwuaW5uZXJUZXh0ID0gJ+S4i+S4gOatpSc7XG4gICAgICAgICAgJChcIi5idG4ucnVuXCIpLmlubmVyVGV4dCA9IFwi5YGc5q2iXCI7XG4gICAgICAgICAgJChcIi5idG4ucnVuXCIpLmNsYXNzTmFtZSA9IFwiYnRuIHN0b3BcIjtcbiAgICAgICAgfVxuICAgICAgICBvby5uZXh0KGdldE1ldGhvZCgpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWwuaW5uZXJUZXh0ID0gJ+WNleatpeiwg+ivlSc7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHNlYXJjaDogZnVuY3Rpb24gKCkge1xuICAgICAgICBvby5jbGVhcigpO1xuICAgICAgICB2YXIgc2VhcmNoVGV4dCA9IGdldFNlYXJjaFRleHQoKTtcbiAgICAgICAgb28uc2VhcmNoKGdldE1ldGhvZCgpLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgIGlmIChub2RlLmNoaWxkTm9kZXNbMF0udGV4dENvbnRlbnQudHJpbSgpID09PSBzZWFyY2hUZXh0KSB7XG4gICAgICAgICAgICBub2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjRjAwJztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG59XG5cbnZhciB0cmVlT2JqID0gVHJlZSgpO1xuXG5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuICB2YXIgZWwgPSBlLnNyY0VsZW1lbnQgfHwgZS50YXJnZXQ7XG5cbiAgc3dpdGNoKGVsLmNsYXNzTmFtZSkge1xuICAgIGNhc2UgJ2J0biBydW4nOlxuICAgICAgdHJlZU9iai5ydW4oZWwpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYnRuIHN0b3AnOlxuICAgICAgdHJlZU9iai5zdG9wKGVsKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2J0biBkZWJ1Zyc6XG4gICAgICB0cmVlT2JqLmRlYnVnKGVsKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ21ldGhvZHMnOlxuICAgICAgdHJlZU9iai5zdG9wKCQoXCIuYnRuLnN0b3BcIikgfHwgJChcIi5idG4ucnVuXCIpKTtcbiAgICAgIC8vIHJlc2V0KCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdidG4gc2VhcmNoJzpcbiAgICAgIHRyZWVPYmouc2VhcmNoKCk7XG4gICAgICBicmVhaztcbiAgfVxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
