'use strict';

function $(el) {
  return document.querySelector(el);
}

function BTree(el) {
  this._isRunning = false;
  this._root = document.querySelector(el);
  this._index = 0;
  this._steps = [];
  this._it = undefined;
}

BTree.prototype = {
  constructor: BTree,

  // 根据选择的遍历方法遍历
  traverse: function traverse(process, method) {
    method = method || 'preOrder';

    // 前序遍历
    function preOrder(node) {
      if (node === null) return;

      process.call(this, node);

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        preOrder(e);
      });
    }

    function inOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    // 后序遍历
    function postOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    switch (method) {
      case 'preOrder':
        preOrder(this._root);
        break;
      case 'inOrder':
        inOrder(this._root);
        break;
      case 'postOrder':
        postOrder(this._root);
        break;
    }
  },

  clear: function clear() {
    this.traverse(function (node) {
      node.style.backgroundColor = "#FFF";
    });
  },

  toArray: function toArray(method) {
    var _ = [];
    this.traverse(function (node) {
      _.push(node);
    }, method);
    return _;
  },

  init: function init(method) {
    this._steps = this.toArray(method);
  },

  run: function run(method, speed, callback) {
    if (this._isRunning) return;

    this._isRunning = true;

    var self = this;
    this._it = setInterval(cycle(), speed || 1000);

    // 闭包
    // cycle 函数只被执行一次
    function cycle() {
      var index = 0;
      var _ = self.toArray(method);
      // var _ = self._steps;

      return function () {
        if (index === _.length) {
          clearInterval(self._it);
          self._it = undefined;
          self._isRunning = false;
          callback();
        }

        if (index !== 0) _[index - 1].style.backgroundColor = '#FFF';

        if (index != _.length) _[index].style.backgroundColor = '#000';

        index += 1;
      };
    }
  },

  stop: function stop() {
    this.clear();
    this._index = 0; // reset index

    if (this._it) {
      this._isRunning = false;
      clearInterval(this._it);
      this._it = undefined;
    }
  },

  next: function next(method, callback) {
    this._steps = this.toArray(method);
    if (this._index !== 0) this._steps[this._index - 1].style.backgroundColor = "#FFF";

    if (this._index !== this._steps.length) {
      this._steps[this._index++].style.backgroundColor = "#000";
    } else {
      this._index = 0; // reset index
      callback();
    }
  },

  search: function search(method, callback) {
    this.traverse(callback, method);
  }
};

function reset() {
  if ($(".btn.stop")) {
    $(".btn.stop").innerText = '运行';
    $(".btn.stop").className = 'btn run';
    $(".btn.debug").innerText = '单步调试';
  }
}

function getMethod() {
  var _options = $('#method').children;
  return Array.prototype.filter.call(_options, function (e) {
    if (e.selected) return e.value;
  })[0].value;
}

function getSearchText() {
  return $("#search-text").value.trim();
}

function Tree() {
  var oo = new BTree(".container");

  return {
    run: function run(el) {
      $(".btn.debug").disabled = "disabled";
      el.innerText = "停止";
      el.className = "btn stop";
      oo.run(getMethod(), 1000, function () {
        $(".btn.debug").disabled = "";
        el.innerText = "运行";
      });
    },
    stop: function stop(el) {
      $(".btn.debug").disabled = "";
      el.innerText = "运行";
      el.className = "btn run";
      $(".btn.debug").innerText = "单步调试";
      oo.stop();
    },
    debug: function debug(el) {
      if ($(".btn.run")) {
        el.innerText = '下一步';
        $(".btn.run").innerText = "停止";
        $(".btn.run").className = "btn stop";
      }
      oo.next(getMethod(), function () {
        el.innerText = '单步调试';
      });
    },
    search: function search() {
      var searchText = getSearchText();
      if (!searchText) return;

      var found = false;
      oo.clear();

      oo.search(getMethod(), function (node) {
        if (node.childNodes[0].textContent.trim() === searchText) {
          node.style.backgroundColor = 'rgb(241, 100, 100)';
          found = true;
          // node.style.border = "none";
          // node.style.boxShadow = "2px 2px 2px rgba(0, 0, 0, 0.50)";
          // node.style.color = "#FFF";
        }
      });

      if (!found) alert('表中不存在: ' + searchText);
    }
  };
}

var treeObj = Tree();

addEventListener("click", function (e) {
  e = e || window.event;
  var el = e.srcElement || e.target;

  switch (el.className) {
    case 'btn run':
      treeObj.run(el);
      break;
    case 'btn stop':
      treeObj.stop(el);
      break;
    case 'btn debug':
      treeObj.debug(el);
      break;
    case 'methods':
      treeObj.stop($(".btn.stop") || $(".btn.run"));
      // reset();
      break;
    case 'btn search':
      treeObj.search();
      break;
  }
});
//# sourceMappingURL=data:application/json;base64,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bnQiOlsiZnVuY3Rpb24gJCAoZWwpIHtcbiAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xufVxuXG5mdW5jdGlvbiBCVHJlZShlbCkge1xuICB0aGlzLl9pc1J1bm5pbmcgPSBmYWxzZTtcbiAgdGhpcy5fcm9vdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xuICB0aGlzLl9pbmRleCA9IDA7XG4gIHRoaXMuX3N0ZXBzID0gW107XG4gIHRoaXMuX2l0ID0gdW5kZWZpbmVkO1xufVxuXG5CVHJlZS5wcm90b3R5cGUgPSB7XG4gIGNvbnN0cnVjdG9yOiBCVHJlZSxcblxuICAvLyDmoLnmja7pgInmi6nnmoTpgY3ljobmlrnms5XpgY3ljoZcbiAgdHJhdmVyc2U6IGZ1bmN0aW9uIChwcm9jZXNzLCBtZXRob2QpIHtcbiAgICBtZXRob2QgPSBtZXRob2QgfHwgJ3ByZU9yZGVyJztcblxuICAgIC8vIOWJjeW6j+mBjeWOhlxuICAgIGZ1bmN0aW9uIHByZU9yZGVyKG5vZGUpIHtcbiAgICAgIGlmIChub2RlID09PSBudWxsKSByZXR1cm4gO1xuXG4gICAgICBwcm9jZXNzLmNhbGwodGhpcywgbm9kZSk7XG5cbiAgICAgIC8vIOi/meaYr+S6jOWPieagkeS4juWkmuWPieagkeeahOWMuuWIqzog5aSa5Liq5a2Q6IqC54K5XG4gICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKG5vZGUuY2hpbGRyZW4sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHByZU9yZGVyKGUpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5PcmRlcihub2RlKSB7XG4gICAgICBpZiAobm9kZSA9PT0gbnVsbCkgcmV0dXJuIDtcblxuICAgICAgLy8g6L+Z5piv5LqM5Y+J5qCR5LiO5aSa5Y+J5qCR55qE5Yy65YirOiDlpJrkuKrlrZDoioLngrlcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcG9zdE9yZGVyKGUpO1xuICAgICAgfSk7XG5cbiAgICAgIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTtcbiAgICB9XG5cbiAgICAvLyDlkI7luo/pgY3ljoZcbiAgICBmdW5jdGlvbiBwb3N0T3JkZXIobm9kZSkge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwpIHJldHVybiA7XG5cbiAgICAgIC8vIOi/meaYr+S6jOWPieagkeS4juWkmuWPieagkeeahOWMuuWIqzog5aSa5Liq5a2Q6IqC54K5XG4gICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKG5vZGUuY2hpbGRyZW4sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHBvc3RPcmRlcihlKTtcbiAgICAgIH0pO1xuXG4gICAgICBwcm9jZXNzLmNhbGwodGhpcywgbm9kZSk7XG4gICAgfVxuXG4gICAgc3dpdGNoKG1ldGhvZCkge1xuICAgICAgY2FzZSAncHJlT3JkZXInOlxuICAgICAgICBwcmVPcmRlcih0aGlzLl9yb290KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdpbk9yZGVyJzpcbiAgICAgICAgaW5PcmRlcih0aGlzLl9yb290KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdwb3N0T3JkZXInOlxuICAgICAgICBwb3N0T3JkZXIodGhpcy5fcm9vdCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfSxcblxuICBjbGVhcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudHJhdmVyc2UoZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIG5vZGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjRkZGXCI7XG4gICAgfSk7XG4gIH0sXG5cbiAgdG9BcnJheTogZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgIHZhciBfID0gW107XG4gICAgdGhpcy50cmF2ZXJzZShmdW5jdGlvbiAobm9kZSkge1xuICAgICAgXy5wdXNoKG5vZGUpO1xuICAgIH0sIG1ldGhvZCk7XG4gICAgcmV0dXJuIF87XG4gIH0sXG5cbiAgaW5pdDogZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgIHRoaXMuX3N0ZXBzID0gdGhpcy50b0FycmF5KG1ldGhvZCk7XG4gIH0sXG5cbiAgcnVuOiBmdW5jdGlvbiAobWV0aG9kLCBzcGVlZCwgY2FsbGJhY2spIHtcbiAgICBpZiAodGhpcy5faXNSdW5uaW5nKSByZXR1cm4gO1xuXG4gICAgdGhpcy5faXNSdW5uaW5nID0gdHJ1ZTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLl9pdCA9IHNldEludGVydmFsKGN5Y2xlKCksIHNwZWVkIHx8IDEwMDApO1xuXG4gICAgLy8g6Zet5YyFXG4gICAgLy8gY3ljbGUg5Ye95pWw5Y+q6KKr5omn6KGM5LiA5qyhXG4gICAgZnVuY3Rpb24gY3ljbGUoKSB7XG4gICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgdmFyIF8gPSBzZWxmLnRvQXJyYXkobWV0aG9kKTtcbiAgICAgIC8vIHZhciBfID0gc2VsZi5fc3RlcHM7XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChpbmRleCA9PT0gXy5sZW5ndGgpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKHNlbGYuX2l0KTtcbiAgICAgICAgICBzZWxmLl9pdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBzZWxmLl9pc1J1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluZGV4ICE9PSAwKVxuICAgICAgICAgIF9baW5kZXgtMV0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNGRkYnO1xuXG4gICAgICAgIGlmIChpbmRleCAhPSBfLmxlbmd0aClcbiAgICAgICAgX1tpbmRleF0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyMwMDAnO1xuXG4gICAgICAgIGluZGV4ICs9IDE7XG4gICAgICB9O1xuICAgIH1cbiAgfSxcblxuICBzdG9wOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jbGVhcigpO1xuICAgIHRoaXMuX2luZGV4ID0gMDsgLy8gcmVzZXQgaW5kZXhcblxuICAgIGlmICh0aGlzLl9pdCkge1xuICAgICAgdGhpcy5faXNSdW5uaW5nID0gZmFsc2U7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuX2l0KTtcbiAgICAgIHRoaXMuX2l0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfSxcblxuICBuZXh0OiBmdW5jdGlvbiAobWV0aG9kLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX3N0ZXBzID0gdGhpcy50b0FycmF5KG1ldGhvZCk7XG4gICAgaWYgKHRoaXMuX2luZGV4ICE9PSAwKVxuICAgICAgdGhpcy5fc3RlcHNbdGhpcy5faW5kZXgtMV0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjRkZGXCI7XG5cbiAgICBpZiAodGhpcy5faW5kZXggIT09IHRoaXMuX3N0ZXBzLmxlbmd0aCkge1xuICAgICAgdGhpcy5fc3RlcHNbdGhpcy5faW5kZXgrK10uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjMDAwXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2luZGV4ID0gMDsgLy8gcmVzZXQgaW5kZXhcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfVxuICB9LFxuXG4gIHNlYXJjaDogZnVuY3Rpb24gKG1ldGhvZCwgY2FsbGJhY2spIHtcbiAgICB0aGlzLnRyYXZlcnNlKGNhbGxiYWNrLCBtZXRob2QpO1xuICB9LFxufTtcblxuXG5mdW5jdGlvbiByZXNldCgpIHtcbiAgaWYgKCQoXCIuYnRuLnN0b3BcIikpIHtcbiAgICAkKFwiLmJ0bi5zdG9wXCIpLmlubmVyVGV4dCA9ICfov5DooYwnO1xuICAgICQoXCIuYnRuLnN0b3BcIikuY2xhc3NOYW1lID0gJ2J0biBydW4nO1xuICAgICQoXCIuYnRuLmRlYnVnXCIpLmlubmVyVGV4dCA9ICfljZXmraXosIPor5UnO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldE1ldGhvZCgpIHtcbiAgdmFyIF9vcHRpb25zID0gJCgnI21ldGhvZCcpLmNoaWxkcmVuO1xuICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKF9vcHRpb25zLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnNlbGVjdGVkKSByZXR1cm4gZS52YWx1ZTtcbiAgfSlbMF0udmFsdWU7XG59XG5cbmZ1bmN0aW9uIGdldFNlYXJjaFRleHQoKSB7XG4gIHJldHVybiAkKFwiI3NlYXJjaC10ZXh0XCIpLnZhbHVlLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gVHJlZSgpIHtcbiAgICB2YXIgb28gPSBuZXcgQlRyZWUoXCIuY29udGFpbmVyXCIpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJ1bjogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmRpc2FibGVkID0gXCJkaXNhYmxlZFwiO1xuICAgICAgICBlbC5pbm5lclRleHQgPSBcIuWBnOatolwiO1xuICAgICAgICBlbC5jbGFzc05hbWUgPSBcImJ0biBzdG9wXCI7XG4gICAgICAgIG9vLnJ1bihnZXRNZXRob2QoKSwgMTAwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmRpc2FibGVkID0gXCJcIjtcbiAgICAgICAgICBlbC5pbm5lclRleHQgPSBcIui/kOihjFwiO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBzdG9wOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgJChcIi5idG4uZGVidWdcIikuZGlzYWJsZWQgPSBcIlwiO1xuICAgICAgICBlbC5pbm5lclRleHQgPSBcIui/kOihjFwiO1xuICAgICAgICBlbC5jbGFzc05hbWUgPSBcImJ0biBydW5cIjtcbiAgICAgICAgJChcIi5idG4uZGVidWdcIikuaW5uZXJUZXh0ID0gXCLljZXmraXosIPor5VcIjtcbiAgICAgICAgb28uc3RvcCgpO1xuICAgICAgfSxcbiAgICAgIGRlYnVnOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgaWYgKCQoXCIuYnRuLnJ1blwiKSkge1xuICAgICAgICAgIGVsLmlubmVyVGV4dCA9ICfkuIvkuIDmraUnO1xuICAgICAgICAgICQoXCIuYnRuLnJ1blwiKS5pbm5lclRleHQgPSBcIuWBnOatolwiO1xuICAgICAgICAgICQoXCIuYnRuLnJ1blwiKS5jbGFzc05hbWUgPSBcImJ0biBzdG9wXCI7XG4gICAgICAgIH1cbiAgICAgICAgb28ubmV4dChnZXRNZXRob2QoKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGVsLmlubmVyVGV4dCA9ICfljZXmraXosIPor5UnO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBzZWFyY2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlYXJjaFRleHQgPSBnZXRTZWFyY2hUZXh0KCk7XG4gICAgICAgIGlmICghIHNlYXJjaFRleHQpIHJldHVybiA7XG5cbiAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgICAgIG9vLmNsZWFyKCk7XG5cbiAgICAgICAgb28uc2VhcmNoKGdldE1ldGhvZCgpLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgIGlmIChub2RlLmNoaWxkTm9kZXNbMF0udGV4dENvbnRlbnQudHJpbSgpID09PSBzZWFyY2hUZXh0KSB7XG4gICAgICAgICAgICBub2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2IoMjQxLCAxMDAsIDEwMCknO1xuICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgLy8gbm9kZS5zdHlsZS5ib3JkZXIgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIC8vIG5vZGUuc3R5bGUuYm94U2hhZG93ID0gXCIycHggMnB4IDJweCByZ2JhKDAsIDAsIDAsIDAuNTApXCI7XG4gICAgICAgICAgICAvLyBub2RlLnN0eWxlLmNvbG9yID0gXCIjRkZGXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoISBmb3VuZCkgYWxlcnQoYOihqOS4reS4jeWtmOWcqDogJHtzZWFyY2hUZXh0fWApO1xuICAgICAgfVxuICAgIH07XG59XG5cbnZhciB0cmVlT2JqID0gVHJlZSgpO1xuXG5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgZSA9IGUgfHwgd2luZG93LmV2ZW50O1xuICB2YXIgZWwgPSBlLnNyY0VsZW1lbnQgfHwgZS50YXJnZXQ7XG5cbiAgc3dpdGNoKGVsLmNsYXNzTmFtZSkge1xuICAgIGNhc2UgJ2J0biBydW4nOlxuICAgICAgdHJlZU9iai5ydW4oZWwpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYnRuIHN0b3AnOlxuICAgICAgdHJlZU9iai5zdG9wKGVsKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2J0biBkZWJ1Zyc6XG4gICAgICB0cmVlT2JqLmRlYnVnKGVsKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ21ldGhvZHMnOlxuICAgICAgdHJlZU9iai5zdG9wKCQoXCIuYnRuLnN0b3BcIikgfHwgJChcIi5idG4ucnVuXCIpKTtcbiAgICAgIC8vIHJlc2V0KCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdidG4gc2VhcmNoJzpcbiAgICAgIHRyZWVPYmouc2VhcmNoKCk7XG4gICAgICBicmVhaztcbiAgfVxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
