'use strict';

function $(el) {
  return document.querySelector(el);
}

function BTree(el) {
  this._isRunning = false;
  this._root = document.querySelector(el);
  this._index = 0;
  this._steps = [];
  this._it = undefined;
}

BTree.prototype = {
  constructor: BTree,

  // 根据选择的遍历方法遍历
  traverse: function traverse(process, method, beginNode) {
    method = method || 'preOrder';
    beginNode = beginNode || this._root;

    // 前序遍历
    function preOrder(node) {
      if (node === null) return;

      process.call(this, node);

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        preOrder(e);
      });
    }

    function inOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    // 后序遍历
    function postOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    switch (method) {
      case 'preOrder':
        // preOrder(this._root);
        preOrder(beginNode);
        break;
      case 'inOrder':
        // inOrder(this._root);
        inOrder(beginNode);
        break;
      case 'postOrder':
        // postOrder(this._root);
        postOrder(beginNode);
        break;
    }
  },

  add: function add(addedNode, startNode) {
    this.clear(); // reset all style

    startNode = startNode || this._root; // startNode will not be null

    // addedNode.style.backgroundColor = "";
    startNode.appendChild(addedNode);
  },

  contains: function contains(node, startNode) {
    startNode = startNode || this._root;
    var found = false;

    this.traverse(function (enode) {
      if (enode === node) {
        found = true;
      }
    });

    return found;
  },

  clear: function clear() {
    this.traverse(function (node) {
      node.style.backgroundColor = "#FFF";
    });
  },

  remove: function remove(startNode) {
    // 只能用后序遍历删除节点
    this.traverse(function (node) {
      node.parentNode.removeChild(node); // parentNode and parentElement
    }, 'postOrder', startNode);
  },

  toArray: function toArray(method) {
    var _ = [];
    this.traverse(function (node) {
      _.push(node);
    }, method);
    return _;
  },

  init: function init(method) {
    this._steps = this.toArray(method);
  },

  run: function run(method, speed, callback) {
    if (this._isRunning) return;

    this._isRunning = true;

    var self = this;
    this._it = setInterval(cycle(), speed || 1000);

    // 闭包
    // cycle 函数只被执行一次
    function cycle() {
      var index = 0;
      var _ = self.toArray(method);
      // var _ = self._steps;

      return function () {
        if (index === _.length) {
          clearInterval(self._it);
          self._it = undefined;
          self._isRunning = false;
          callback();
        }

        if (index !== 0) _[index - 1].style.backgroundColor = '#FFF';

        if (index != _.length) _[index].style.backgroundColor = '#000';

        index += 1;
      };
    }
  },

  stop: function stop() {
    this.clear();
    this._index = 0; // reset index

    if (this._it) {
      this._isRunning = false;
      clearInterval(this._it);
      this._it = undefined;
    }
  },

  next: function next(method, callback) {
    this._steps = this.toArray(method);
    if (this._index !== 0) this._steps[this._index - 1].style.backgroundColor = "#FFF";

    if (this._index !== this._steps.length) {
      this._steps[this._index++].style.backgroundColor = "#000";
    } else {
      this._index = 0; // reset index
      callback();
    }
  },

  search: function search(method, callback) {
    this.traverse(callback, method);
  }
};

// 实际操作
function Tree() {
  var oo = new BTree(".container");
  var targetNode;

  function reset() {
    if ($(".btn.stop")) {
      $(".btn.stop").innerText = '运行';
      $(".btn.stop").className = 'btn run';
      $(".btn.debug").innerText = '单步调试';
    }
  }

  function getMethod() {
    var _options = $('#method').children;
    return Array.prototype.filter.call(_options, function (e) {
      if (e.selected) return e.value;
    })[0].value;
  }

  function getSearchText() {
    return $("#search-text").value.trim();
  }

  function getNewNodeText() {
    return $("#add-text").value.trim();
  }

  function setState() {
    var delBtn = $(".btn.delete");
    var addNodeInput = $("#add-text");
    var addBtn = $(".btn.add");

    this.enable = function () {
      delBtn.disabled = "";
      addNodeInput.disabled = "";
      addBtn.disabled = "";
    };

    this.disable = function () {
      delBtn.disabled = "disabled";
      addNodeInput.disabled = "disabled";
      addBtn.disabled = "disabled";
    };

    return this;
  }

  return {
    run: function run(el) {
      $(".btn.debug").disabled = "disabled";
      el.innerText = "停止";
      el.className = "btn stop";
      oo.run(getMethod(), 1000, function () {
        $(".btn.debug").disabled = "";
        el.innerText = "运行";
      });
    },
    stop: function stop(el) {
      $(".btn.debug").disabled = "";
      el.innerText = "运行";
      el.className = "btn run";
      $(".btn.debug").innerText = "单步调试";
      oo.stop();
    },
    debug: function debug(el) {
      if ($(".btn.run")) {
        el.innerText = '下一步';
        $(".btn.run").innerText = "停止";
        $(".btn.run").className = "btn stop";
      }
      oo.next(getMethod(), function () {
        el.innerText = '单步调试';
      });
    },
    search: function search() {
      var searchText = getSearchText();
      if (!searchText) return;

      var found = false;
      oo.clear();

      oo.search(getMethod(), function (node) {
        if (node.childNodes[0].textContent.trim() === searchText) {
          node.style.backgroundColor = 'rgb(241, 100, 100)';
          found = true;
          // node.style.border = "none";
          // node.style.boxShadow = "2px 2px 2px rgba(0, 0, 0, 0.50)";
          // node.style.color = "#FFF";
        }
      });

      if (!found) alert('表中不存在: ' + searchText);
    },
    // 选择节点: 只有选择父节点中的节点才能删除和添加
    target: function target(el) {

      if (oo.contains(el)) {
        oo.clear();
        targetNode = el;
        el.style.backgroundColor = '#F00';
        new setState().enable();
      } else if (el.id != 'add-text') {
        new setState().disable();
        oo.clear();
      }
    },
    delete: function _delete() {
      if (targetNode) {
        oo.remove(targetNode); // // 禁用删除和增加按钮
        new setState().disable();
      }
    },
    add: function add() {
      if (targetNode) {
        new setState().disable(); // 禁用删除和增加按钮
        var _newNode = document.createElement('div');
        _newNode.className = "node new";
        _newNode.innerText = getNewNodeText();
        _newNode.style.backgroundColor = "#0F0";
        oo.add(_newNode, targetNode);
      }
    }
  };
}

var treeObj = Tree();

addEventListener("click", function (e) {
  e = e || window.event;
  var el = e.srcElement || e.target;

  switch (el.className) {
    case 'btn run':
      treeObj.run(el);
      break;
    case 'btn stop':
      treeObj.stop(el);
      break;
    case 'btn debug':
      treeObj.debug(el);
      break;
    case 'methods':
      treeObj.stop($(".btn.stop") || $(".btn.run"));
      // reset();
      break;
    case 'btn search':
      treeObj.search();
      break;
    case 'btn delete':
      treeObj.delete();
      break;
    case 'btn add':
      treeObj.add();
      break;
    default:
      treeObj.target(el);
      break;
  }
});
//# sourceMappingURL=data:application/json;base64,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O0FBcEJGO0FBd0JJLGNBQVEsTUFBUixDQUFlLEVBQWYsRUFERjtBQUVFLFlBRkY7QUF2QkYsR0FKcUM7Q0FBYixDQUExQiIsImZpbGUiOiJ0YXNrLTI0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gJCAoZWwpIHtcbiAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xufVxuXG5mdW5jdGlvbiBCVHJlZShlbCkge1xuICB0aGlzLl9pc1J1bm5pbmcgPSBmYWxzZTtcbiAgdGhpcy5fcm9vdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xuICB0aGlzLl9pbmRleCA9IDA7XG4gIHRoaXMuX3N0ZXBzID0gW107XG4gIHRoaXMuX2l0ID0gdW5kZWZpbmVkO1xufVxuXG5CVHJlZS5wcm90b3R5cGUgPSB7XG4gIGNvbnN0cnVjdG9yOiBCVHJlZSxcblxuICAvLyDmoLnmja7pgInmi6nnmoTpgY3ljobmlrnms5XpgY3ljoZcbiAgdHJhdmVyc2U6IGZ1bmN0aW9uIChwcm9jZXNzLCBtZXRob2QsIGJlZ2luTm9kZSkge1xuICAgIG1ldGhvZCA9IG1ldGhvZCB8fCAncHJlT3JkZXInO1xuICAgIGJlZ2luTm9kZSA9IGJlZ2luTm9kZSB8fCB0aGlzLl9yb290O1xuXG4gICAgLy8g5YmN5bqP6YGN5Y6GXG4gICAgZnVuY3Rpb24gcHJlT3JkZXIobm9kZSkge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwpIHJldHVybiA7XG5cbiAgICAgIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTtcblxuICAgICAgLy8g6L+Z5piv5LqM5Y+J5qCR5LiO5aSa5Y+J5qCR55qE5Yy65YirOiDlpJrkuKrlrZDoioLngrlcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcHJlT3JkZXIoZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbk9yZGVyKG5vZGUpIHtcbiAgICAgIGlmIChub2RlID09PSBudWxsKSByZXR1cm4gO1xuXG4gICAgICAvLyDov5nmmK/kuozlj4nmoJHkuI7lpJrlj4nmoJHnmoTljLrliKs6IOWkmuS4quWtkOiKgueCuVxuICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChub2RlLmNoaWxkcmVuLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBwb3N0T3JkZXIoZSk7XG4gICAgICB9KTtcblxuICAgICAgcHJvY2Vzcy5jYWxsKHRoaXMsIG5vZGUpO1xuICAgIH1cblxuICAgIC8vIOWQjuW6j+mBjeWOhlxuICAgIGZ1bmN0aW9uIHBvc3RPcmRlcihub2RlKSB7XG4gICAgICBpZiAobm9kZSA9PT0gbnVsbCkgcmV0dXJuIDtcblxuICAgICAgLy8g6L+Z5piv5LqM5Y+J5qCR5LiO5aSa5Y+J5qCR55qE5Yy65YirOiDlpJrkuKrlrZDoioLngrlcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcG9zdE9yZGVyKGUpO1xuICAgICAgfSk7XG5cbiAgICAgIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTtcbiAgICB9XG5cbiAgICBzd2l0Y2gobWV0aG9kKSB7XG4gICAgICBjYXNlICdwcmVPcmRlcic6XG4gICAgICAgIC8vIHByZU9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBwcmVPcmRlcihiZWdpbk5vZGUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2luT3JkZXInOlxuICAgICAgICAvLyBpbk9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBpbk9yZGVyKGJlZ2luTm9kZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncG9zdE9yZGVyJzpcbiAgICAgICAgLy8gcG9zdE9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBwb3N0T3JkZXIoYmVnaW5Ob2RlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9LFxuXG4gIGFkZDogZnVuY3Rpb24gKGFkZGVkTm9kZSwgc3RhcnROb2RlKSB7XG4gICAgdGhpcy5jbGVhcigpOyAvLyByZXNldCBhbGwgc3R5bGVcblxuICAgIHN0YXJ0Tm9kZSA9IHN0YXJ0Tm9kZSB8fCB0aGlzLl9yb290OyAvLyBzdGFydE5vZGUgd2lsbCBub3QgYmUgbnVsbFxuXG4gICAgLy8gYWRkZWROb2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiXCI7XG4gICAgc3RhcnROb2RlLmFwcGVuZENoaWxkKGFkZGVkTm9kZSk7XG4gIH0sXG5cbiAgY29udGFpbnM6IGZ1bmN0aW9uIChub2RlLCBzdGFydE5vZGUpIHtcbiAgICBzdGFydE5vZGUgPSBzdGFydE5vZGUgfHwgdGhpcy5fcm9vdDtcbiAgICB2YXIgZm91bmQgPSBmYWxzZTtcblxuICAgIHRoaXMudHJhdmVyc2UoZnVuY3Rpb24gKGVub2RlKSB7XG4gICAgICBpZiAoZW5vZGUgPT09IG5vZGUpIHtcbiAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZvdW5kO1xuICB9LFxuXG4gIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy50cmF2ZXJzZShmdW5jdGlvbiAobm9kZSkge1xuICAgICAgbm9kZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNGRkZcIjtcbiAgICB9KTtcbiAgfSxcblxuICByZW1vdmU6IGZ1bmN0aW9uIChzdGFydE5vZGUpIHtcbiAgICAvLyDlj6rog73nlKjlkI7luo/pgY3ljobliKDpmaToioLngrlcbiAgICB0aGlzLnRyYXZlcnNlKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7IC8vIHBhcmVudE5vZGUgYW5kIHBhcmVudEVsZW1lbnRcbiAgICB9LCAncG9zdE9yZGVyJywgc3RhcnROb2RlKTtcbiAgfSxcblxuICB0b0FycmF5OiBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgdmFyIF8gPSBbXTtcbiAgICB0aGlzLnRyYXZlcnNlKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICBfLnB1c2gobm9kZSk7XG4gICAgfSwgbWV0aG9kKTtcbiAgICByZXR1cm4gXztcbiAgfSxcblxuICBpbml0OiBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgdGhpcy5fc3RlcHMgPSB0aGlzLnRvQXJyYXkobWV0aG9kKTtcbiAgfSxcblxuICBydW46IGZ1bmN0aW9uIChtZXRob2QsIHNwZWVkLCBjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLl9pc1J1bm5pbmcpIHJldHVybiA7XG5cbiAgICB0aGlzLl9pc1J1bm5pbmcgPSB0cnVlO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuX2l0ID0gc2V0SW50ZXJ2YWwoY3ljbGUoKSwgc3BlZWQgfHwgMTAwMCk7XG5cbiAgICAvLyDpl63ljIVcbiAgICAvLyBjeWNsZSDlh73mlbDlj6rooqvmiafooYzkuIDmrKFcbiAgICBmdW5jdGlvbiBjeWNsZSgpIHtcbiAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICB2YXIgXyA9IHNlbGYudG9BcnJheShtZXRob2QpO1xuICAgICAgLy8gdmFyIF8gPSBzZWxmLl9zdGVwcztcblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGluZGV4ID09PSBfLmxlbmd0aCkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2VsZi5faXQpO1xuICAgICAgICAgIHNlbGYuX2l0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgIHNlbGYuX2lzUnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5kZXggIT09IDApXG4gICAgICAgICAgX1tpbmRleC0xXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGRic7XG5cbiAgICAgICAgaWYgKGluZGV4ICE9IF8ubGVuZ3RoKVxuICAgICAgICBfW2luZGV4XS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnIzAwMCc7XG5cbiAgICAgICAgaW5kZXggKz0gMTtcbiAgICAgIH07XG4gICAgfVxuICB9LFxuXG4gIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgdGhpcy5faW5kZXggPSAwOyAvLyByZXNldCBpbmRleFxuXG4gICAgaWYgKHRoaXMuX2l0KSB7XG4gICAgICB0aGlzLl9pc1J1bm5pbmcgPSBmYWxzZTtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faXQpO1xuICAgICAgdGhpcy5faXQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9LFxuXG4gIG5leHQ6IGZ1bmN0aW9uIChtZXRob2QsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fc3RlcHMgPSB0aGlzLnRvQXJyYXkobWV0aG9kKTtcbiAgICBpZiAodGhpcy5faW5kZXggIT09IDApXG4gICAgICB0aGlzLl9zdGVwc1t0aGlzLl9pbmRleC0xXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNGRkZcIjtcblxuICAgIGlmICh0aGlzLl9pbmRleCAhPT0gdGhpcy5fc3RlcHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9zdGVwc1t0aGlzLl9pbmRleCsrXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiMwMDBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faW5kZXggPSAwOyAvLyByZXNldCBpbmRleFxuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH0sXG5cbiAgc2VhcmNoOiBmdW5jdGlvbiAobWV0aG9kLCBjYWxsYmFjaykge1xuICAgIHRoaXMudHJhdmVyc2UoY2FsbGJhY2ssIG1ldGhvZCk7XG4gIH0sXG59O1xuXG4vLyDlrp7pmYXmk43kvZxcbmZ1bmN0aW9uIFRyZWUoKSB7XG4gICAgdmFyIG9vID0gbmV3IEJUcmVlKFwiLmNvbnRhaW5lclwiKTtcbiAgICB2YXIgdGFyZ2V0Tm9kZTtcblxuICAgIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgaWYgKCQoXCIuYnRuLnN0b3BcIikpIHtcbiAgICAgICAgJChcIi5idG4uc3RvcFwiKS5pbm5lclRleHQgPSAn6L+Q6KGMJztcbiAgICAgICAgJChcIi5idG4uc3RvcFwiKS5jbGFzc05hbWUgPSAnYnRuIHJ1bic7XG4gICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmlubmVyVGV4dCA9ICfljZXmraXosIPor5UnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE1ldGhvZCgpIHtcbiAgICAgIHZhciBfb3B0aW9ucyA9ICQoJyNtZXRob2QnKS5jaGlsZHJlbjtcbiAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuZmlsdGVyLmNhbGwoX29wdGlvbnMsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLnNlbGVjdGVkKSByZXR1cm4gZS52YWx1ZTtcbiAgICAgIH0pWzBdLnZhbHVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNlYXJjaFRleHQoKSB7XG4gICAgICByZXR1cm4gJChcIiNzZWFyY2gtdGV4dFwiKS52YWx1ZS50cmltKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0TmV3Tm9kZVRleHQoKSB7XG4gICAgICByZXR1cm4gJChcIiNhZGQtdGV4dFwiKS52YWx1ZS50cmltKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0U3RhdGUoKSB7XG4gICAgICB2YXIgZGVsQnRuID0gJChcIi5idG4uZGVsZXRlXCIpO1xuICAgICAgdmFyIGFkZE5vZGVJbnB1dCA9ICQoXCIjYWRkLXRleHRcIik7XG4gICAgICB2YXIgYWRkQnRuID0gJChcIi5idG4uYWRkXCIpO1xuXG4gICAgICB0aGlzLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVsQnRuLmRpc2FibGVkID0gXCJcIjtcbiAgICAgICAgYWRkTm9kZUlucHV0LmRpc2FibGVkID0gXCJcIjtcbiAgICAgICAgYWRkQnRuLmRpc2FibGVkID0gXCJcIjtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVsQnRuLmRpc2FibGVkID0gXCJkaXNhYmxlZFwiO1xuICAgICAgICBhZGROb2RlSW5wdXQuZGlzYWJsZWQgPSBcImRpc2FibGVkXCI7XG4gICAgICAgIGFkZEJ0bi5kaXNhYmxlZCA9IFwiZGlzYWJsZWRcIjtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBydW46IGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAkKFwiLmJ0bi5kZWJ1Z1wiKS5kaXNhYmxlZCA9IFwiZGlzYWJsZWRcIjtcbiAgICAgICAgZWwuaW5uZXJUZXh0ID0gXCLlgZzmraJcIjtcbiAgICAgICAgZWwuY2xhc3NOYW1lID0gXCJidG4gc3RvcFwiO1xuICAgICAgICBvby5ydW4oZ2V0TWV0aG9kKCksIDEwMDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkKFwiLmJ0bi5kZWJ1Z1wiKS5kaXNhYmxlZCA9IFwiXCI7XG4gICAgICAgICAgZWwuaW5uZXJUZXh0ID0gXCLov5DooYxcIjtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgc3RvcDogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmRpc2FibGVkID0gXCJcIjtcbiAgICAgICAgZWwuaW5uZXJUZXh0ID0gXCLov5DooYxcIjtcbiAgICAgICAgZWwuY2xhc3NOYW1lID0gXCJidG4gcnVuXCI7XG4gICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmlubmVyVGV4dCA9IFwi5Y2V5q2l6LCD6K+VXCI7XG4gICAgICAgIG9vLnN0b3AoKTtcbiAgICAgIH0sXG4gICAgICBkZWJ1ZzogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIGlmICgkKFwiLmJ0bi5ydW5cIikpIHtcbiAgICAgICAgICBlbC5pbm5lclRleHQgPSAn5LiL5LiA5q2lJztcbiAgICAgICAgICAkKFwiLmJ0bi5ydW5cIikuaW5uZXJUZXh0ID0gXCLlgZzmraJcIjtcbiAgICAgICAgICAkKFwiLmJ0bi5ydW5cIikuY2xhc3NOYW1lID0gXCJidG4gc3RvcFwiO1xuICAgICAgICB9XG4gICAgICAgIG9vLm5leHQoZ2V0TWV0aG9kKCksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlbC5pbm5lclRleHQgPSAn5Y2V5q2l6LCD6K+VJztcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgc2VhcmNoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWFyY2hUZXh0ID0gZ2V0U2VhcmNoVGV4dCgpO1xuICAgICAgICBpZiAoISBzZWFyY2hUZXh0KSByZXR1cm4gO1xuXG4gICAgICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgICAgICBvby5jbGVhcigpO1xuXG4gICAgICAgIG9vLnNlYXJjaChnZXRNZXRob2QoKSwgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICBpZiAobm9kZS5jaGlsZE5vZGVzWzBdLnRleHRDb250ZW50LnRyaW0oKSA9PT0gc2VhcmNoVGV4dCkge1xuICAgICAgICAgICAgbm9kZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmdiKDI0MSwgMTAwLCAxMDApJztcbiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vIG5vZGUuc3R5bGUuYm9yZGVyID0gXCJub25lXCI7XG4gICAgICAgICAgICAvLyBub2RlLnN0eWxlLmJveFNoYWRvdyA9IFwiMnB4IDJweCAycHggcmdiYSgwLCAwLCAwLCAwLjUwKVwiO1xuICAgICAgICAgICAgLy8gbm9kZS5zdHlsZS5jb2xvciA9IFwiI0ZGRlwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCEgZm91bmQpIGFsZXJ0KGDooajkuK3kuI3lrZjlnKg6ICR7c2VhcmNoVGV4dH1gKTtcbiAgICAgIH0sXG4gICAgICAvLyDpgInmi6noioLngrk6IOWPquaciemAieaLqeeItuiKgueCueS4reeahOiKgueCueaJjeiDveWIoOmZpOWSjOa3u+WKoFxuICAgICAgdGFyZ2V0OiBmdW5jdGlvbiAoZWwpIHtcblxuICAgICAgICBpZiAob28uY29udGFpbnMoZWwpKSB7XG4gICAgICAgICAgb28uY2xlYXIoKTtcbiAgICAgICAgICB0YXJnZXROb2RlID0gZWw7XG4gICAgICAgICAgZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNGMDAnO1xuICAgICAgICAgIG5ldyBzZXRTdGF0ZSgpLmVuYWJsZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKGVsLmlkICE9ICdhZGQtdGV4dCcpe1xuICAgICAgICAgIG5ldyBzZXRTdGF0ZSgpLmRpc2FibGUoKTtcbiAgICAgICAgICBvby5jbGVhcigpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0YXJnZXROb2RlKSB7XG4gICAgICAgICAgb28ucmVtb3ZlKHRhcmdldE5vZGUpOyAvLyAvLyDnpoHnlKjliKDpmaTlkozlop7liqDmjInpkq5cbiAgICAgICAgICBuZXcgc2V0U3RhdGUoKS5kaXNhYmxlKCk7XG4gICAgICAgIH1cblxuICAgICAgfSxcbiAgICAgIGFkZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGFyZ2V0Tm9kZSkge1xuICAgICAgICAgIG5ldyBzZXRTdGF0ZSgpLmRpc2FibGUoKTsgLy8g56aB55So5Yig6Zmk5ZKM5aKe5Yqg5oyJ6ZKuXG4gICAgICAgICAgdmFyIF9uZXdOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgX25ld05vZGUuY2xhc3NOYW1lID0gXCJub2RlIG5ld1wiO1xuICAgICAgICAgIF9uZXdOb2RlLmlubmVyVGV4dCA9IGdldE5ld05vZGVUZXh0KCk7XG4gICAgICAgICAgX25ld05vZGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjMEYwXCI7XG4gICAgICAgICAgb28uYWRkKF9uZXdOb2RlLCB0YXJnZXROb2RlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xufVxuXG52YXIgdHJlZU9iaiA9IFRyZWUoKTtcblxuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgdmFyIGVsID0gZS5zcmNFbGVtZW50IHx8IGUudGFyZ2V0O1xuXG4gIHN3aXRjaChlbC5jbGFzc05hbWUpIHtcbiAgICBjYXNlICdidG4gcnVuJzpcbiAgICAgIHRyZWVPYmoucnVuKGVsKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2J0biBzdG9wJzpcbiAgICAgIHRyZWVPYmouc3RvcChlbCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdidG4gZGVidWcnOlxuICAgICAgdHJlZU9iai5kZWJ1ZyhlbCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtZXRob2RzJzpcbiAgICAgIHRyZWVPYmouc3RvcCgkKFwiLmJ0bi5zdG9wXCIpIHx8ICQoXCIuYnRuLnJ1blwiKSk7XG4gICAgICAvLyByZXNldCgpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYnRuIHNlYXJjaCc6XG4gICAgICB0cmVlT2JqLnNlYXJjaCgpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYnRuIGRlbGV0ZSc6XG4gICAgICB0cmVlT2JqLmRlbGV0ZSgpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYnRuIGFkZCc6XG4gICAgICB0cmVlT2JqLmFkZCgpO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRyZWVPYmoudGFyZ2V0KGVsKTtcbiAgICAgIGJyZWFrO1xuICB9XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
