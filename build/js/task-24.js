'use strict';

function $(el) {
  return document.querySelector(el);
}

function BTree(el) {
  this._isRunning = false;
  this._root = document.querySelector(el);
  this._index = 0;
  this._steps = [];
  this._it = undefined;
}

BTree.prototype = {
  constructor: BTree,

  // 根据选择的遍历方法遍历
  traverse: function traverse(process, method, beginNode) {
    method = method || 'preOrder';
    beginNode = beginNode || this._root;

    // 前序遍历
    function preOrder(node) {
      if (node === null) return;

      process.call(this, node);

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        preOrder(e);
      });
    }

    function inOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    // 后序遍历
    function postOrder(node) {
      if (node === null) return;

      // 这是二叉树与多叉树的区别: 多个子节点
      Array.prototype.forEach.call(node.children, function (e) {
        postOrder(e);
      });

      process.call(this, node);
    }

    switch (method) {
      case 'preOrder':
        // preOrder(this._root);
        preOrder(beginNode);
        break;
      case 'inOrder':
        // inOrder(this._root);
        inOrder(beginNode);
        break;
      case 'postOrder':
        // postOrder(this._root);
        postOrder(beginNode);
        break;
    }
  },

  add: function add(addedNode, startNode) {
    this.clear(); // reset all style

    startNode = startNode || this._root; // startNode will not be null

    startNode.appendChild(addedNode);
  },

  contains: function contains(node, startNode) {
    startNode = startNode || this._root;
    var found = false;

    this.traverse(function (enode) {
      if (enode === node) {
        found = true;
      }
    });

    return found;
  },

  clear: function clear() {
    this.traverse(function (node) {
      node.style.backgroundColor = "#FFF";
    });
  },

  remove: function remove(startNode) {
    // 只能用后序遍历删除节点
    this.traverse(function (node) {
      node.parentNode.removeChild(node); // parentNode and parentElement
    }, 'postOrder', startNode);
  },

  toArray: function toArray(method) {
    var _ = [];
    this.traverse(function (node) {
      _.push(node);
    }, method);
    return _;
  },

  init: function init(method) {
    this._steps = this.toArray(method);
  },

  run: function run(method, speed, callback) {
    if (this._isRunning) return;

    this._isRunning = true;

    var self = this;
    this._it = setInterval(cycle(), speed || 1000);

    // 闭包
    // cycle 函数只被执行一次
    function cycle() {
      var index = 0;
      var _ = self.toArray(method);
      // var _ = self._steps;

      return function () {
        if (index === _.length) {
          clearInterval(self._it);
          self._it = undefined;
          self._isRunning = false;
          callback();
        }

        if (index !== 0) _[index - 1].style.backgroundColor = '#FFF';

        if (index != _.length) _[index].style.backgroundColor = '#000';

        index += 1;
      };
    }
  },

  stop: function stop() {
    this.clear();
    this._index = 0; // reset index

    if (this._it) {
      this._isRunning = false;
      clearInterval(this._it);
      this._it = undefined;
    }
  },

  next: function next(method, callback) {
    this._steps = this.toArray(method);
    if (this._index !== 0) this._steps[this._index - 1].style.backgroundColor = "#FFF";

    if (this._index !== this._steps.length) {
      this._steps[this._index++].style.backgroundColor = "#000";
    } else {
      this._index = 0; // reset index
      callback();
    }
  },

  search: function search(method, callback) {
    this.traverse(callback, method);
  }
};

// 实际操作
function Tree() {
  var oo = new BTree(".container");
  var targetNode;

  function reset() {
    if ($(".btn.stop")) {
      $(".btn.stop").innerText = '运行';
      $(".btn.stop").className = 'btn run';
      $(".btn.debug").innerText = '单步调试';
    }
  }

  function getMethod() {
    var _options = $('#method').children;
    return Array.prototype.filter.call(_options, function (e) {
      if (e.selected) return e.value;
    })[0].value;
  }

  function getSearchText() {
    return $("#search-text").value.trim();
  }

  function getNewNodeText() {
    return $("#add-text").value.trim();
  }

  function setState() {
    var delBtn = $(".btn.delete");
    var addNodeInput = $("#add-text");
    var addBtn = $(".btn.add");

    this.enable = function () {
      delBtn.disabled = "";
      addNodeInput.disabled = "";
      addBtn.disabled = "";
    };

    this.disable = function () {
      delBtn.disabled = "disabled";
      addNodeInput.disabled = "disabled";
      addBtn.disabled = "disabled";
    };

    this.focus = function () {
      addNodeInput.focus();
    };

    return this;
  }

  return {
    run: function run(el) {
      $(".btn.debug").disabled = "disabled";
      el.innerText = "停止";
      el.className = "btn stop";
      oo.run(getMethod(), 1000, function () {
        $(".btn.debug").disabled = "";
        el.innerText = "运行";
      });
    },
    stop: function stop(el) {
      $(".btn.debug").disabled = "";
      el.innerText = "运行";
      el.className = "btn run";
      $(".btn.debug").innerText = "单步调试";
      oo.stop();
    },
    debug: function debug(el) {
      if ($(".btn.run")) {
        el.innerText = '下一步';
        $(".btn.run").innerText = "停止";
        $(".btn.run").className = "btn stop";
      }
      oo.next(getMethod(), function () {
        el.innerText = '单步调试';
      });
    },
    search: function search() {
      var searchText = getSearchText();
      if (!searchText) return;

      var found = false;
      oo.clear();

      oo.search(getMethod(), function (node) {
        if (node.childNodes[0].textContent.trim() === searchText) {
          node.style.backgroundColor = 'rgb(241, 100, 100)';
          found = true;
          // node.style.border = "none";
          // node.style.boxShadow = "2px 2px 2px rgba(0, 0, 0, 0.50)";
          // node.style.color = "#FFF";
        }
      });

      if (!found) alert('表中不存在: ' + searchText);
    },
    // 选择节点: 只有选择父节点中的节点才能删除和添加
    target: function target(el) {

      if (oo.contains(el)) {
        new setState().focus();
        oo.clear();
        targetNode = el;
        el.style.backgroundColor = '#F00';
        new setState().enable();
      } else if (el.id != 'add-text') {
        new setState().disable();
        oo.clear();
      }
    },
    delete: function _delete() {
      if (targetNode) {
        oo.remove(targetNode); // // 禁用删除和增加按钮
        new setState().disable();
      }
    },
    add: function add() {
      if (targetNode) {
        new setState().disable(); // 禁用删除和增加按钮
        var _newNode = document.createElement('div');
        _newNode.className = "node new";
        _newNode.innerText = getNewNodeText();
        _newNode.style.backgroundColor = "#0F0";
        oo.add(_newNode, targetNode);
      }
    }
  };
}

var treeObj = Tree();

addEventListener("click", function (e) {
  e = e || window.event;
  var el = e.srcElement || e.target;

  switch (el.className) {
    case 'btn run':
      treeObj.run(el);
      break;
    case 'btn stop':
      treeObj.stop(el);
      break;
    case 'btn debug':
      treeObj.debug(el);
      break;
    case 'methods':
      treeObj.stop($(".btn.stop") || $(".btn.run"));
      // reset();
      break;
    case 'btn search':
      treeObj.search();
      break;
    case 'btn delete':
      treeObj.delete();
      break;
    case 'btn add':
      treeObj.add();
      break;
    default:
      treeObj.target(el);
      break;
  }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhc2stMjQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxTQUFTLENBQVQsQ0FBWSxFQUFaLEVBQWdCO0FBQ2QsU0FBTyxTQUFTLGFBQVQsQ0FBdUIsRUFBdkIsQ0FBUCxDQURjO0NBQWhCOztBQUlBLFNBQVMsS0FBVCxDQUFlLEVBQWYsRUFBbUI7QUFDakIsT0FBSyxVQUFMLEdBQWtCLEtBQWxCLENBRGlCO0FBRWpCLE9BQUssS0FBTCxHQUFhLFNBQVMsYUFBVCxDQUF1QixFQUF2QixDQUFiLENBRmlCO0FBR2pCLE9BQUssTUFBTCxHQUFjLENBQWQsQ0FIaUI7QUFJakIsT0FBSyxNQUFMLEdBQWMsRUFBZCxDQUppQjtBQUtqQixPQUFLLEdBQUwsR0FBVyxTQUFYLENBTGlCO0NBQW5COztBQVFBLE1BQU0sU0FBTixHQUFrQjtBQUNoQixlQUFhLEtBQWI7OztBQUdBLFlBQVUsa0JBQVUsT0FBVixFQUFtQixNQUFuQixFQUEyQixTQUEzQixFQUFzQztBQUM5QyxhQUFTLFVBQVUsVUFBVixDQURxQztBQUU5QyxnQkFBWSxhQUFhLEtBQUssS0FBTDs7O0FBRnFCLGFBS3JDLFFBQVQsQ0FBa0IsSUFBbEIsRUFBd0I7QUFDdEIsVUFBSSxTQUFTLElBQVQsRUFBZSxPQUFuQjs7QUFFQSxjQUFRLElBQVIsQ0FBYSxJQUFiLEVBQW1CLElBQW5COzs7QUFIc0IsV0FNdEIsQ0FBTSxTQUFOLENBQWdCLE9BQWhCLENBQXdCLElBQXhCLENBQTZCLEtBQUssUUFBTCxFQUFlLFVBQVUsQ0FBVixFQUFhO0FBQ3ZELGlCQUFTLENBQVQsRUFEdUQ7T0FBYixDQUE1QyxDQU5zQjtLQUF4Qjs7QUFXQSxhQUFTLE9BQVQsQ0FBaUIsSUFBakIsRUFBdUI7QUFDckIsVUFBSSxTQUFTLElBQVQsRUFBZSxPQUFuQjs7O0FBRHFCLFdBSXJCLENBQU0sU0FBTixDQUFnQixPQUFoQixDQUF3QixJQUF4QixDQUE2QixLQUFLLFFBQUwsRUFBZSxVQUFVLENBQVYsRUFBYTtBQUN2RCxrQkFBVSxDQUFWLEVBRHVEO09BQWIsQ0FBNUMsQ0FKcUI7O0FBUXJCLGNBQVEsSUFBUixDQUFhLElBQWIsRUFBbUIsSUFBbkIsRUFScUI7S0FBdkI7OztBQWhCOEMsYUE0QnJDLFNBQVQsQ0FBbUIsSUFBbkIsRUFBeUI7QUFDdkIsVUFBSSxTQUFTLElBQVQsRUFBZSxPQUFuQjs7O0FBRHVCLFdBSXZCLENBQU0sU0FBTixDQUFnQixPQUFoQixDQUF3QixJQUF4QixDQUE2QixLQUFLLFFBQUwsRUFBZSxVQUFVLENBQVYsRUFBYTtBQUN2RCxrQkFBVSxDQUFWLEVBRHVEO09BQWIsQ0FBNUMsQ0FKdUI7O0FBUXZCLGNBQVEsSUFBUixDQUFhLElBQWIsRUFBbUIsSUFBbkIsRUFSdUI7S0FBekI7O0FBV0EsWUFBTyxNQUFQO0FBQ0UsV0FBSyxVQUFMOztBQUVFLGlCQUFTLFNBQVQsRUFGRjtBQUdFLGNBSEY7QUFERixXQUtPLFNBQUw7O0FBRUUsZ0JBQVEsU0FBUixFQUZGO0FBR0UsY0FIRjtBQUxGLFdBU08sV0FBTDs7QUFFRSxrQkFBVSxTQUFWLEVBRkY7QUFHRSxjQUhGO0FBVEYsS0F2QzhDO0dBQXRDOztBQXVEVixPQUFLLGFBQVUsU0FBVixFQUFxQixTQUFyQixFQUFnQztBQUNuQyxTQUFLLEtBQUw7O0FBRG1DLGFBR25DLEdBQVksYUFBYSxLQUFLLEtBQUw7O0FBSFUsYUFLbkMsQ0FBVSxXQUFWLENBQXNCLFNBQXRCLEVBTG1DO0dBQWhDOztBQVFMLFlBQVUsa0JBQVUsSUFBVixFQUFnQixTQUFoQixFQUEyQjtBQUNuQyxnQkFBWSxhQUFhLEtBQUssS0FBTCxDQURVO0FBRW5DLFFBQUksUUFBUSxLQUFSLENBRitCOztBQUluQyxTQUFLLFFBQUwsQ0FBYyxVQUFVLEtBQVYsRUFBaUI7QUFDN0IsVUFBSSxVQUFVLElBQVYsRUFBZ0I7QUFDbEIsZ0JBQVEsSUFBUixDQURrQjtPQUFwQjtLQURZLENBQWQsQ0FKbUM7O0FBVW5DLFdBQU8sS0FBUCxDQVZtQztHQUEzQjs7QUFhVixTQUFPLGlCQUFZO0FBQ2pCLFNBQUssUUFBTCxDQUFjLFVBQVUsSUFBVixFQUFnQjtBQUM1QixXQUFLLEtBQUwsQ0FBVyxlQUFYLEdBQTZCLE1BQTdCLENBRDRCO0tBQWhCLENBQWQsQ0FEaUI7R0FBWjs7QUFNUCxVQUFRLGdCQUFVLFNBQVYsRUFBcUI7O0FBRTNCLFNBQUssUUFBTCxDQUFjLFVBQVUsSUFBVixFQUFnQjtBQUM1QixXQUFLLFVBQUwsQ0FBZ0IsV0FBaEIsQ0FBNEIsSUFBNUI7QUFENEIsS0FBaEIsRUFFWCxXQUZILEVBRWdCLFNBRmhCLEVBRjJCO0dBQXJCOztBQU9SLFdBQVMsaUJBQVUsTUFBVixFQUFrQjtBQUN6QixRQUFJLElBQUksRUFBSixDQURxQjtBQUV6QixTQUFLLFFBQUwsQ0FBYyxVQUFVLElBQVYsRUFBZ0I7QUFDNUIsUUFBRSxJQUFGLENBQU8sSUFBUCxFQUQ0QjtLQUFoQixFQUVYLE1BRkgsRUFGeUI7QUFLekIsV0FBTyxDQUFQLENBTHlCO0dBQWxCOztBQVFULFFBQU0sY0FBVSxNQUFWLEVBQWtCO0FBQ3RCLFNBQUssTUFBTCxHQUFjLEtBQUssT0FBTCxDQUFhLE1BQWIsQ0FBZCxDQURzQjtHQUFsQjs7QUFJTixPQUFLLGFBQVUsTUFBVixFQUFrQixLQUFsQixFQUF5QixRQUF6QixFQUFtQztBQUN0QyxRQUFJLEtBQUssVUFBTCxFQUFpQixPQUFyQjs7QUFFQSxTQUFLLFVBQUwsR0FBa0IsSUFBbEIsQ0FIc0M7O0FBS3RDLFFBQUksT0FBTyxJQUFQLENBTGtDO0FBTXRDLFNBQUssR0FBTCxHQUFXLFlBQVksT0FBWixFQUFxQixTQUFTLElBQVQsQ0FBaEM7Ozs7QUFOc0MsYUFVN0IsS0FBVCxHQUFpQjtBQUNmLFVBQUksUUFBUSxDQUFSLENBRFc7QUFFZixVQUFJLElBQUksS0FBSyxPQUFMLENBQWEsTUFBYixDQUFKOzs7QUFGVyxhQUtSLFlBQVk7QUFDakIsWUFBSSxVQUFVLEVBQUUsTUFBRixFQUFVO0FBQ3RCLHdCQUFjLEtBQUssR0FBTCxDQUFkLENBRHNCO0FBRXRCLGVBQUssR0FBTCxHQUFXLFNBQVgsQ0FGc0I7QUFHdEIsZUFBSyxVQUFMLEdBQWtCLEtBQWxCLENBSHNCO0FBSXRCLHFCQUpzQjtTQUF4Qjs7QUFPQSxZQUFJLFVBQVUsQ0FBVixFQUNGLEVBQUUsUUFBTSxDQUFOLENBQUYsQ0FBVyxLQUFYLENBQWlCLGVBQWpCLEdBQW1DLE1BQW5DLENBREY7O0FBR0EsWUFBSSxTQUFTLEVBQUUsTUFBRixFQUNiLEVBQUUsS0FBRixFQUFTLEtBQVQsQ0FBZSxlQUFmLEdBQWlDLE1BQWpDLENBREE7O0FBR0EsaUJBQVMsQ0FBVCxDQWRpQjtPQUFaLENBTFE7S0FBakI7R0FWRzs7QUFrQ0wsUUFBTSxnQkFBWTtBQUNoQixTQUFLLEtBQUwsR0FEZ0I7QUFFaEIsU0FBSyxNQUFMLEdBQWMsQ0FBZDs7QUFGZ0IsUUFJWixLQUFLLEdBQUwsRUFBVTtBQUNaLFdBQUssVUFBTCxHQUFrQixLQUFsQixDQURZO0FBRVosb0JBQWMsS0FBSyxHQUFMLENBQWQsQ0FGWTtBQUdaLFdBQUssR0FBTCxHQUFXLFNBQVgsQ0FIWTtLQUFkO0dBSkk7O0FBV04sUUFBTSxjQUFVLE1BQVYsRUFBa0IsUUFBbEIsRUFBNEI7QUFDaEMsU0FBSyxNQUFMLEdBQWMsS0FBSyxPQUFMLENBQWEsTUFBYixDQUFkLENBRGdDO0FBRWhDLFFBQUksS0FBSyxNQUFMLEtBQWdCLENBQWhCLEVBQ0YsS0FBSyxNQUFMLENBQVksS0FBSyxNQUFMLEdBQVksQ0FBWixDQUFaLENBQTJCLEtBQTNCLENBQWlDLGVBQWpDLEdBQW1ELE1BQW5ELENBREY7O0FBR0EsUUFBSSxLQUFLLE1BQUwsS0FBZ0IsS0FBSyxNQUFMLENBQVksTUFBWixFQUFvQjtBQUN0QyxXQUFLLE1BQUwsQ0FBWSxLQUFLLE1BQUwsRUFBWixFQUEyQixLQUEzQixDQUFpQyxlQUFqQyxHQUFtRCxNQUFuRCxDQURzQztLQUF4QyxNQUVPO0FBQ0wsV0FBSyxNQUFMLEdBQWMsQ0FBZDtBQURLLGNBRUwsR0FGSztLQUZQO0dBTEk7O0FBYU4sVUFBUSxnQkFBVSxNQUFWLEVBQWtCLFFBQWxCLEVBQTRCO0FBQ2xDLFNBQUssUUFBTCxDQUFjLFFBQWQsRUFBd0IsTUFBeEIsRUFEa0M7R0FBNUI7Q0FuS1Y7OztBQXlLQSxTQUFTLElBQVQsR0FBZ0I7QUFDWixNQUFJLEtBQUssSUFBSSxLQUFKLENBQVUsWUFBVixDQUFMLENBRFE7QUFFWixNQUFJLFVBQUosQ0FGWTs7QUFJWixXQUFTLEtBQVQsR0FBaUI7QUFDZixRQUFJLEVBQUUsV0FBRixDQUFKLEVBQW9CO0FBQ2xCLFFBQUUsV0FBRixFQUFlLFNBQWYsR0FBMkIsSUFBM0IsQ0FEa0I7QUFFbEIsUUFBRSxXQUFGLEVBQWUsU0FBZixHQUEyQixTQUEzQixDQUZrQjtBQUdsQixRQUFFLFlBQUYsRUFBZ0IsU0FBaEIsR0FBNEIsTUFBNUIsQ0FIa0I7S0FBcEI7R0FERjs7QUFRQSxXQUFTLFNBQVQsR0FBcUI7QUFDbkIsUUFBSSxXQUFXLEVBQUUsU0FBRixFQUFhLFFBQWIsQ0FESTtBQUVuQixXQUFPLE1BQU0sU0FBTixDQUFnQixNQUFoQixDQUF1QixJQUF2QixDQUE0QixRQUE1QixFQUFzQyxVQUFVLENBQVYsRUFBYTtBQUN4RCxVQUFJLEVBQUUsUUFBRixFQUFZLE9BQU8sRUFBRSxLQUFGLENBQXZCO0tBRDJDLENBQXRDLENBRUosQ0FGSSxFQUVELEtBRkMsQ0FGWTtHQUFyQjs7QUFPQSxXQUFTLGFBQVQsR0FBeUI7QUFDdkIsV0FBTyxFQUFFLGNBQUYsRUFBa0IsS0FBbEIsQ0FBd0IsSUFBeEIsRUFBUCxDQUR1QjtHQUF6Qjs7QUFJQSxXQUFTLGNBQVQsR0FBMEI7QUFDeEIsV0FBTyxFQUFFLFdBQUYsRUFBZSxLQUFmLENBQXFCLElBQXJCLEVBQVAsQ0FEd0I7R0FBMUI7O0FBSUEsV0FBUyxRQUFULEdBQW9CO0FBQ2xCLFFBQUksU0FBUyxFQUFFLGFBQUYsQ0FBVCxDQURjO0FBRWxCLFFBQUksZUFBZSxFQUFFLFdBQUYsQ0FBZixDQUZjO0FBR2xCLFFBQUksU0FBUyxFQUFFLFVBQUYsQ0FBVCxDQUhjOztBQUtsQixTQUFLLE1BQUwsR0FBYyxZQUFZO0FBQ3hCLGFBQU8sUUFBUCxHQUFrQixFQUFsQixDQUR3QjtBQUV4QixtQkFBYSxRQUFiLEdBQXdCLEVBQXhCLENBRndCO0FBR3hCLGFBQU8sUUFBUCxHQUFrQixFQUFsQixDQUh3QjtLQUFaLENBTEk7O0FBV2xCLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsYUFBTyxRQUFQLEdBQWtCLFVBQWxCLENBRHlCO0FBRXpCLG1CQUFhLFFBQWIsR0FBd0IsVUFBeEIsQ0FGeUI7QUFHekIsYUFBTyxRQUFQLEdBQWtCLFVBQWxCLENBSHlCO0tBQVosQ0FYRzs7QUFpQmxCLFNBQUssS0FBTCxHQUFhLFlBQVk7QUFDdkIsbUJBQWEsS0FBYixHQUR1QjtLQUFaLENBakJLOztBQXFCbEIsV0FBTyxJQUFQLENBckJrQjtHQUFwQjs7QUF3QkEsU0FBTztBQUNMLFNBQUssYUFBVSxFQUFWLEVBQWM7QUFDakIsUUFBRSxZQUFGLEVBQWdCLFFBQWhCLEdBQTJCLFVBQTNCLENBRGlCO0FBRWpCLFNBQUcsU0FBSCxHQUFlLElBQWYsQ0FGaUI7QUFHakIsU0FBRyxTQUFILEdBQWUsVUFBZixDQUhpQjtBQUlqQixTQUFHLEdBQUgsQ0FBTyxXQUFQLEVBQW9CLElBQXBCLEVBQTBCLFlBQVk7QUFDcEMsVUFBRSxZQUFGLEVBQWdCLFFBQWhCLEdBQTJCLEVBQTNCLENBRG9DO0FBRXBDLFdBQUcsU0FBSCxHQUFlLElBQWYsQ0FGb0M7T0FBWixDQUExQixDQUppQjtLQUFkO0FBU0wsVUFBTSxjQUFVLEVBQVYsRUFBYztBQUNsQixRQUFFLFlBQUYsRUFBZ0IsUUFBaEIsR0FBMkIsRUFBM0IsQ0FEa0I7QUFFbEIsU0FBRyxTQUFILEdBQWUsSUFBZixDQUZrQjtBQUdsQixTQUFHLFNBQUgsR0FBZSxTQUFmLENBSGtCO0FBSWxCLFFBQUUsWUFBRixFQUFnQixTQUFoQixHQUE0QixNQUE1QixDQUprQjtBQUtsQixTQUFHLElBQUgsR0FMa0I7S0FBZDtBQU9OLFdBQU8sZUFBVSxFQUFWLEVBQWM7QUFDbkIsVUFBSSxFQUFFLFVBQUYsQ0FBSixFQUFtQjtBQUNqQixXQUFHLFNBQUgsR0FBZSxLQUFmLENBRGlCO0FBRWpCLFVBQUUsVUFBRixFQUFjLFNBQWQsR0FBMEIsSUFBMUIsQ0FGaUI7QUFHakIsVUFBRSxVQUFGLEVBQWMsU0FBZCxHQUEwQixVQUExQixDQUhpQjtPQUFuQjtBQUtBLFNBQUcsSUFBSCxDQUFRLFdBQVIsRUFBcUIsWUFBWTtBQUMvQixXQUFHLFNBQUgsR0FBZSxNQUFmLENBRCtCO09BQVosQ0FBckIsQ0FObUI7S0FBZDtBQVVQLFlBQVEsa0JBQVk7QUFDbEIsVUFBSSxhQUFhLGVBQWIsQ0FEYztBQUVsQixVQUFJLENBQUUsVUFBRixFQUFjLE9BQWxCOztBQUVBLFVBQUksUUFBUSxLQUFSLENBSmM7QUFLbEIsU0FBRyxLQUFILEdBTGtCOztBQU9sQixTQUFHLE1BQUgsQ0FBVSxXQUFWLEVBQXVCLFVBQVUsSUFBVixFQUFnQjtBQUNyQyxZQUFJLEtBQUssVUFBTCxDQUFnQixDQUFoQixFQUFtQixXQUFuQixDQUErQixJQUEvQixPQUEwQyxVQUExQyxFQUFzRDtBQUN4RCxlQUFLLEtBQUwsQ0FBVyxlQUFYLEdBQTZCLG9CQUE3QixDQUR3RDtBQUV4RCxrQkFBUSxJQUFSOzs7O0FBRndELFNBQTFEO09BRHFCLENBQXZCLENBUGtCOztBQWlCbEIsVUFBSSxDQUFFLEtBQUYsRUFBUyxrQkFBZ0IsVUFBaEIsRUFBYjtLQWpCTTs7QUFvQlIsWUFBUSxnQkFBVSxFQUFWLEVBQWM7O0FBRXBCLFVBQUksR0FBRyxRQUFILENBQVksRUFBWixDQUFKLEVBQXFCO0FBQ25CLFlBQUksUUFBSixHQUFlLEtBQWYsR0FEbUI7QUFFbkIsV0FBRyxLQUFILEdBRm1CO0FBR25CLHFCQUFhLEVBQWIsQ0FIbUI7QUFJbkIsV0FBRyxLQUFILENBQVMsZUFBVCxHQUEyQixNQUEzQixDQUptQjtBQUtuQixZQUFJLFFBQUosR0FBZSxNQUFmLEdBTG1CO09BQXJCLE1BTU8sSUFBSSxHQUFHLEVBQUgsSUFBUyxVQUFULEVBQW9CO0FBQzdCLFlBQUksUUFBSixHQUFlLE9BQWYsR0FENkI7QUFFN0IsV0FBRyxLQUFILEdBRjZCO09BQXhCO0tBUkQ7QUFhUixZQUFRLG1CQUFZO0FBQ2xCLFVBQUksVUFBSixFQUFnQjtBQUNkLFdBQUcsTUFBSCxDQUFVLFVBQVY7QUFEYyxZQUVWLFFBQUosR0FBZSxPQUFmLEdBRmM7T0FBaEI7S0FETTtBQU9SLFNBQUssZUFBWTtBQUNmLFVBQUksVUFBSixFQUFnQjtBQUNkLFlBQUksUUFBSixHQUFlLE9BQWY7QUFEYyxZQUVWLFdBQVcsU0FBUyxhQUFULENBQXVCLEtBQXZCLENBQVgsQ0FGVTtBQUdkLGlCQUFTLFNBQVQsR0FBcUIsVUFBckIsQ0FIYztBQUlkLGlCQUFTLFNBQVQsR0FBcUIsZ0JBQXJCLENBSmM7QUFLZCxpQkFBUyxLQUFULENBQWUsZUFBZixHQUFpQyxNQUFqQyxDQUxjO0FBTWQsV0FBRyxHQUFILENBQU8sUUFBUCxFQUFpQixVQUFqQixFQU5jO09BQWhCO0tBREc7R0FuRVAsQ0FuRFk7Q0FBaEI7O0FBbUlBLElBQUksVUFBVSxNQUFWOztBQUVKLGlCQUFpQixPQUFqQixFQUEwQixVQUFVLENBQVYsRUFBYTtBQUNyQyxNQUFJLEtBQUssT0FBTyxLQUFQLENBRDRCO0FBRXJDLE1BQUksS0FBSyxFQUFFLFVBQUYsSUFBZ0IsRUFBRSxNQUFGLENBRlk7O0FBSXJDLFVBQU8sR0FBRyxTQUFIO0FBQ0wsU0FBSyxTQUFMO0FBQ0UsY0FBUSxHQUFSLENBQVksRUFBWixFQURGO0FBRUUsWUFGRjtBQURGLFNBSU8sVUFBTDtBQUNFLGNBQVEsSUFBUixDQUFhLEVBQWIsRUFERjtBQUVFLFlBRkY7QUFKRixTQU9PLFdBQUw7QUFDRSxjQUFRLEtBQVIsQ0FBYyxFQUFkLEVBREY7QUFFRSxZQUZGO0FBUEYsU0FVTyxTQUFMO0FBQ0UsY0FBUSxJQUFSLENBQWEsRUFBRSxXQUFGLEtBQWtCLEVBQUUsVUFBRixDQUFsQixDQUFiOztBQURGO0FBVkYsU0FjTyxZQUFMO0FBQ0UsY0FBUSxNQUFSLEdBREY7QUFFRSxZQUZGO0FBZEYsU0FpQk8sWUFBTDtBQUNFLGNBQVEsTUFBUixHQURGO0FBRUUsWUFGRjtBQWpCRixTQW9CTyxTQUFMO0FBQ0UsY0FBUSxHQUFSLEdBREY7QUFFRSxZQUZGO0FBcEJGO0FBd0JJLGNBQVEsTUFBUixDQUFlLEVBQWYsRUFERjtBQUVFLFlBRkY7QUF2QkYsR0FKcUM7Q0FBYixDQUExQiIsImZpbGUiOiJ0YXNrLTI0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gJCAoZWwpIHtcbiAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xufVxuXG5mdW5jdGlvbiBCVHJlZShlbCkge1xuICB0aGlzLl9pc1J1bm5pbmcgPSBmYWxzZTtcbiAgdGhpcy5fcm9vdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpO1xuICB0aGlzLl9pbmRleCA9IDA7XG4gIHRoaXMuX3N0ZXBzID0gW107XG4gIHRoaXMuX2l0ID0gdW5kZWZpbmVkO1xufVxuXG5CVHJlZS5wcm90b3R5cGUgPSB7XG4gIGNvbnN0cnVjdG9yOiBCVHJlZSxcblxuICAvLyDmoLnmja7pgInmi6nnmoTpgY3ljobmlrnms5XpgY3ljoZcbiAgdHJhdmVyc2U6IGZ1bmN0aW9uIChwcm9jZXNzLCBtZXRob2QsIGJlZ2luTm9kZSkge1xuICAgIG1ldGhvZCA9IG1ldGhvZCB8fCAncHJlT3JkZXInO1xuICAgIGJlZ2luTm9kZSA9IGJlZ2luTm9kZSB8fCB0aGlzLl9yb290O1xuXG4gICAgLy8g5YmN5bqP6YGN5Y6GXG4gICAgZnVuY3Rpb24gcHJlT3JkZXIobm9kZSkge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwpIHJldHVybiA7XG5cbiAgICAgIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTtcblxuICAgICAgLy8g6L+Z5piv5LqM5Y+J5qCR5LiO5aSa5Y+J5qCR55qE5Yy65YirOiDlpJrkuKrlrZDoioLngrlcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcHJlT3JkZXIoZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbk9yZGVyKG5vZGUpIHtcbiAgICAgIGlmIChub2RlID09PSBudWxsKSByZXR1cm4gO1xuXG4gICAgICAvLyDov5nmmK/kuozlj4nmoJHkuI7lpJrlj4nmoJHnmoTljLrliKs6IOWkmuS4quWtkOiKgueCuVxuICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChub2RlLmNoaWxkcmVuLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBwb3N0T3JkZXIoZSk7XG4gICAgICB9KTtcblxuICAgICAgcHJvY2Vzcy5jYWxsKHRoaXMsIG5vZGUpO1xuICAgIH1cblxuICAgIC8vIOWQjuW6j+mBjeWOhlxuICAgIGZ1bmN0aW9uIHBvc3RPcmRlcihub2RlKSB7XG4gICAgICBpZiAobm9kZSA9PT0gbnVsbCkgcmV0dXJuIDtcblxuICAgICAgLy8g6L+Z5piv5LqM5Y+J5qCR5LiO5aSa5Y+J5qCR55qE5Yy65YirOiDlpJrkuKrlrZDoioLngrlcbiAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwobm9kZS5jaGlsZHJlbiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcG9zdE9yZGVyKGUpO1xuICAgICAgfSk7XG5cbiAgICAgIHByb2Nlc3MuY2FsbCh0aGlzLCBub2RlKTtcbiAgICB9XG5cbiAgICBzd2l0Y2gobWV0aG9kKSB7XG4gICAgICBjYXNlICdwcmVPcmRlcic6XG4gICAgICAgIC8vIHByZU9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBwcmVPcmRlcihiZWdpbk5vZGUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2luT3JkZXInOlxuICAgICAgICAvLyBpbk9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBpbk9yZGVyKGJlZ2luTm9kZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncG9zdE9yZGVyJzpcbiAgICAgICAgLy8gcG9zdE9yZGVyKHRoaXMuX3Jvb3QpO1xuICAgICAgICBwb3N0T3JkZXIoYmVnaW5Ob2RlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9LFxuXG4gIGFkZDogZnVuY3Rpb24gKGFkZGVkTm9kZSwgc3RhcnROb2RlKSB7XG4gICAgdGhpcy5jbGVhcigpOyAvLyByZXNldCBhbGwgc3R5bGVcblxuICAgIHN0YXJ0Tm9kZSA9IHN0YXJ0Tm9kZSB8fCB0aGlzLl9yb290OyAvLyBzdGFydE5vZGUgd2lsbCBub3QgYmUgbnVsbFxuXG4gICAgc3RhcnROb2RlLmFwcGVuZENoaWxkKGFkZGVkTm9kZSk7XG4gIH0sXG5cbiAgY29udGFpbnM6IGZ1bmN0aW9uIChub2RlLCBzdGFydE5vZGUpIHtcbiAgICBzdGFydE5vZGUgPSBzdGFydE5vZGUgfHwgdGhpcy5fcm9vdDtcbiAgICB2YXIgZm91bmQgPSBmYWxzZTtcblxuICAgIHRoaXMudHJhdmVyc2UoZnVuY3Rpb24gKGVub2RlKSB7XG4gICAgICBpZiAoZW5vZGUgPT09IG5vZGUpIHtcbiAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZvdW5kO1xuICB9LFxuXG4gIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy50cmF2ZXJzZShmdW5jdGlvbiAobm9kZSkge1xuICAgICAgbm9kZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNGRkZcIjtcbiAgICB9KTtcbiAgfSxcblxuICByZW1vdmU6IGZ1bmN0aW9uIChzdGFydE5vZGUpIHtcbiAgICAvLyDlj6rog73nlKjlkI7luo/pgY3ljobliKDpmaToioLngrlcbiAgICB0aGlzLnRyYXZlcnNlKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7IC8vIHBhcmVudE5vZGUgYW5kIHBhcmVudEVsZW1lbnRcbiAgICB9LCAncG9zdE9yZGVyJywgc3RhcnROb2RlKTtcbiAgfSxcblxuICB0b0FycmF5OiBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgdmFyIF8gPSBbXTtcbiAgICB0aGlzLnRyYXZlcnNlKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICBfLnB1c2gobm9kZSk7XG4gICAgfSwgbWV0aG9kKTtcbiAgICByZXR1cm4gXztcbiAgfSxcblxuICBpbml0OiBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgdGhpcy5fc3RlcHMgPSB0aGlzLnRvQXJyYXkobWV0aG9kKTtcbiAgfSxcblxuICBydW46IGZ1bmN0aW9uIChtZXRob2QsIHNwZWVkLCBjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLl9pc1J1bm5pbmcpIHJldHVybiA7XG5cbiAgICB0aGlzLl9pc1J1bm5pbmcgPSB0cnVlO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuX2l0ID0gc2V0SW50ZXJ2YWwoY3ljbGUoKSwgc3BlZWQgfHwgMTAwMCk7XG5cbiAgICAvLyDpl63ljIVcbiAgICAvLyBjeWNsZSDlh73mlbDlj6rooqvmiafooYzkuIDmrKFcbiAgICBmdW5jdGlvbiBjeWNsZSgpIHtcbiAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICB2YXIgXyA9IHNlbGYudG9BcnJheShtZXRob2QpO1xuICAgICAgLy8gdmFyIF8gPSBzZWxmLl9zdGVwcztcblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGluZGV4ID09PSBfLmxlbmd0aCkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2VsZi5faXQpO1xuICAgICAgICAgIHNlbGYuX2l0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgIHNlbGYuX2lzUnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5kZXggIT09IDApXG4gICAgICAgICAgX1tpbmRleC0xXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI0ZGRic7XG5cbiAgICAgICAgaWYgKGluZGV4ICE9IF8ubGVuZ3RoKVxuICAgICAgICBfW2luZGV4XS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnIzAwMCc7XG5cbiAgICAgICAgaW5kZXggKz0gMTtcbiAgICAgIH07XG4gICAgfVxuICB9LFxuXG4gIHN0b3A6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgdGhpcy5faW5kZXggPSAwOyAvLyByZXNldCBpbmRleFxuXG4gICAgaWYgKHRoaXMuX2l0KSB7XG4gICAgICB0aGlzLl9pc1J1bm5pbmcgPSBmYWxzZTtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faXQpO1xuICAgICAgdGhpcy5faXQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9LFxuXG4gIG5leHQ6IGZ1bmN0aW9uIChtZXRob2QsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fc3RlcHMgPSB0aGlzLnRvQXJyYXkobWV0aG9kKTtcbiAgICBpZiAodGhpcy5faW5kZXggIT09IDApXG4gICAgICB0aGlzLl9zdGVwc1t0aGlzLl9pbmRleC0xXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNGRkZcIjtcblxuICAgIGlmICh0aGlzLl9pbmRleCAhPT0gdGhpcy5fc3RlcHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9zdGVwc1t0aGlzLl9pbmRleCsrXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiMwMDBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faW5kZXggPSAwOyAvLyByZXNldCBpbmRleFxuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH0sXG5cbiAgc2VhcmNoOiBmdW5jdGlvbiAobWV0aG9kLCBjYWxsYmFjaykge1xuICAgIHRoaXMudHJhdmVyc2UoY2FsbGJhY2ssIG1ldGhvZCk7XG4gIH0sXG59O1xuXG4vLyDlrp7pmYXmk43kvZxcbmZ1bmN0aW9uIFRyZWUoKSB7XG4gICAgdmFyIG9vID0gbmV3IEJUcmVlKFwiLmNvbnRhaW5lclwiKTtcbiAgICB2YXIgdGFyZ2V0Tm9kZTtcblxuICAgIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgaWYgKCQoXCIuYnRuLnN0b3BcIikpIHtcbiAgICAgICAgJChcIi5idG4uc3RvcFwiKS5pbm5lclRleHQgPSAn6L+Q6KGMJztcbiAgICAgICAgJChcIi5idG4uc3RvcFwiKS5jbGFzc05hbWUgPSAnYnRuIHJ1bic7XG4gICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmlubmVyVGV4dCA9ICfljZXmraXosIPor5UnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE1ldGhvZCgpIHtcbiAgICAgIHZhciBfb3B0aW9ucyA9ICQoJyNtZXRob2QnKS5jaGlsZHJlbjtcbiAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuZmlsdGVyLmNhbGwoX29wdGlvbnMsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLnNlbGVjdGVkKSByZXR1cm4gZS52YWx1ZTtcbiAgICAgIH0pWzBdLnZhbHVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNlYXJjaFRleHQoKSB7XG4gICAgICByZXR1cm4gJChcIiNzZWFyY2gtdGV4dFwiKS52YWx1ZS50cmltKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0TmV3Tm9kZVRleHQoKSB7XG4gICAgICByZXR1cm4gJChcIiNhZGQtdGV4dFwiKS52YWx1ZS50cmltKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0U3RhdGUoKSB7XG4gICAgICB2YXIgZGVsQnRuID0gJChcIi5idG4uZGVsZXRlXCIpO1xuICAgICAgdmFyIGFkZE5vZGVJbnB1dCA9ICQoXCIjYWRkLXRleHRcIik7XG4gICAgICB2YXIgYWRkQnRuID0gJChcIi5idG4uYWRkXCIpO1xuXG4gICAgICB0aGlzLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVsQnRuLmRpc2FibGVkID0gXCJcIjtcbiAgICAgICAgYWRkTm9kZUlucHV0LmRpc2FibGVkID0gXCJcIjtcbiAgICAgICAgYWRkQnRuLmRpc2FibGVkID0gXCJcIjtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVsQnRuLmRpc2FibGVkID0gXCJkaXNhYmxlZFwiO1xuICAgICAgICBhZGROb2RlSW5wdXQuZGlzYWJsZWQgPSBcImRpc2FibGVkXCI7XG4gICAgICAgIGFkZEJ0bi5kaXNhYmxlZCA9IFwiZGlzYWJsZWRcIjtcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFkZE5vZGVJbnB1dC5mb2N1cygpO1xuICAgICAgfTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJ1bjogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmRpc2FibGVkID0gXCJkaXNhYmxlZFwiO1xuICAgICAgICBlbC5pbm5lclRleHQgPSBcIuWBnOatolwiO1xuICAgICAgICBlbC5jbGFzc05hbWUgPSBcImJ0biBzdG9wXCI7XG4gICAgICAgIG9vLnJ1bihnZXRNZXRob2QoKSwgMTAwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICQoXCIuYnRuLmRlYnVnXCIpLmRpc2FibGVkID0gXCJcIjtcbiAgICAgICAgICBlbC5pbm5lclRleHQgPSBcIui/kOihjFwiO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBzdG9wOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgJChcIi5idG4uZGVidWdcIikuZGlzYWJsZWQgPSBcIlwiO1xuICAgICAgICBlbC5pbm5lclRleHQgPSBcIui/kOihjFwiO1xuICAgICAgICBlbC5jbGFzc05hbWUgPSBcImJ0biBydW5cIjtcbiAgICAgICAgJChcIi5idG4uZGVidWdcIikuaW5uZXJUZXh0ID0gXCLljZXmraXosIPor5VcIjtcbiAgICAgICAgb28uc3RvcCgpO1xuICAgICAgfSxcbiAgICAgIGRlYnVnOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgaWYgKCQoXCIuYnRuLnJ1blwiKSkge1xuICAgICAgICAgIGVsLmlubmVyVGV4dCA9ICfkuIvkuIDmraUnO1xuICAgICAgICAgICQoXCIuYnRuLnJ1blwiKS5pbm5lclRleHQgPSBcIuWBnOatolwiO1xuICAgICAgICAgICQoXCIuYnRuLnJ1blwiKS5jbGFzc05hbWUgPSBcImJ0biBzdG9wXCI7XG4gICAgICAgIH1cbiAgICAgICAgb28ubmV4dChnZXRNZXRob2QoKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGVsLmlubmVyVGV4dCA9ICfljZXmraXosIPor5UnO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBzZWFyY2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlYXJjaFRleHQgPSBnZXRTZWFyY2hUZXh0KCk7XG4gICAgICAgIGlmICghIHNlYXJjaFRleHQpIHJldHVybiA7XG5cbiAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgICAgIG9vLmNsZWFyKCk7XG5cbiAgICAgICAgb28uc2VhcmNoKGdldE1ldGhvZCgpLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgIGlmIChub2RlLmNoaWxkTm9kZXNbMF0udGV4dENvbnRlbnQudHJpbSgpID09PSBzZWFyY2hUZXh0KSB7XG4gICAgICAgICAgICBub2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2IoMjQxLCAxMDAsIDEwMCknO1xuICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgLy8gbm9kZS5zdHlsZS5ib3JkZXIgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIC8vIG5vZGUuc3R5bGUuYm94U2hhZG93ID0gXCIycHggMnB4IDJweCByZ2JhKDAsIDAsIDAsIDAuNTApXCI7XG4gICAgICAgICAgICAvLyBub2RlLnN0eWxlLmNvbG9yID0gXCIjRkZGXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoISBmb3VuZCkgYWxlcnQoYOihqOS4reS4jeWtmOWcqDogJHtzZWFyY2hUZXh0fWApO1xuICAgICAgfSxcbiAgICAgIC8vIOmAieaLqeiKgueCuTog5Y+q5pyJ6YCJ5oup54i26IqC54K55Lit55qE6IqC54K55omN6IO95Yig6Zmk5ZKM5re75YqgXG4gICAgICB0YXJnZXQ6IGZ1bmN0aW9uIChlbCkge1xuXG4gICAgICAgIGlmIChvby5jb250YWlucyhlbCkpIHtcbiAgICAgICAgICBuZXcgc2V0U3RhdGUoKS5mb2N1cygpO1xuICAgICAgICAgIG9vLmNsZWFyKCk7XG4gICAgICAgICAgdGFyZ2V0Tm9kZSA9IGVsO1xuICAgICAgICAgIGVsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjRjAwJztcbiAgICAgICAgICBuZXcgc2V0U3RhdGUoKS5lbmFibGUoKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbC5pZCAhPSAnYWRkLXRleHQnKXtcbiAgICAgICAgICBuZXcgc2V0U3RhdGUoKS5kaXNhYmxlKCk7XG4gICAgICAgICAgb28uY2xlYXIoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGFyZ2V0Tm9kZSkge1xuICAgICAgICAgIG9vLnJlbW92ZSh0YXJnZXROb2RlKTsgLy8gLy8g56aB55So5Yig6Zmk5ZKM5aKe5Yqg5oyJ6ZKuXG4gICAgICAgICAgbmV3IHNldFN0YXRlKCkuZGlzYWJsZSgpO1xuICAgICAgICB9XG5cbiAgICAgIH0sXG4gICAgICBhZGQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRhcmdldE5vZGUpIHtcbiAgICAgICAgICBuZXcgc2V0U3RhdGUoKS5kaXNhYmxlKCk7IC8vIOemgeeUqOWIoOmZpOWSjOWinuWKoOaMiemSrlxuICAgICAgICAgIHZhciBfbmV3Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgIF9uZXdOb2RlLmNsYXNzTmFtZSA9IFwibm9kZSBuZXdcIjtcbiAgICAgICAgICBfbmV3Tm9kZS5pbm5lclRleHQgPSBnZXROZXdOb2RlVGV4dCgpO1xuICAgICAgICAgIF9uZXdOb2RlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiIzBGMFwiO1xuICAgICAgICAgIG9vLmFkZChfbmV3Tm9kZSwgdGFyZ2V0Tm9kZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfTtcbn1cblxudmFyIHRyZWVPYmogPSBUcmVlKCk7XG5cbmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gIHZhciBlbCA9IGUuc3JjRWxlbWVudCB8fCBlLnRhcmdldDtcblxuICBzd2l0Y2goZWwuY2xhc3NOYW1lKSB7XG4gICAgY2FzZSAnYnRuIHJ1bic6XG4gICAgICB0cmVlT2JqLnJ1bihlbCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdidG4gc3RvcCc6XG4gICAgICB0cmVlT2JqLnN0b3AoZWwpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYnRuIGRlYnVnJzpcbiAgICAgIHRyZWVPYmouZGVidWcoZWwpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbWV0aG9kcyc6XG4gICAgICB0cmVlT2JqLnN0b3AoJChcIi5idG4uc3RvcFwiKSB8fCAkKFwiLmJ0bi5ydW5cIikpO1xuICAgICAgLy8gcmVzZXQoKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2J0biBzZWFyY2gnOlxuICAgICAgdHJlZU9iai5zZWFyY2goKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2J0biBkZWxldGUnOlxuICAgICAgdHJlZU9iai5kZWxldGUoKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2J0biBhZGQnOlxuICAgICAgdHJlZU9iai5hZGQoKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0cmVlT2JqLnRhcmdldChlbCk7XG4gICAgICBicmVhaztcbiAgfVxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
